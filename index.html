<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Headlines from the Future">
    <meta name="keywords" content="news, technology, opensource, science, mathematics, physics, programming, code, research">
    <meta name="author" content="André Machado">
    <meta name="robots" content="index, follow">
    <meta name="revisit-after" content="1 day">
    <meta name="googlebot" content="noodp">
    <meta name="rating" content="general">
    <meta name="distribution" content="global">
    <title>OpenJournal</title>
    <link rel="icon" type="image/png" href="icon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>    
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Drop Menu code with top buttons inside -->
    <button id="drop-menu" style="margin-left: 5px; margin-top: 10px; margin-bottom: 10px">&#8226;</button>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const buttons = [ 'about-button', 'blogs-button', 'research-button', 'hearts-button', 'comments-button', 'meet-button'];
            const dropMenu = document.getElementById('drop-menu');
        
            const hideButtons = () => {
                buttons.forEach(button => {
                    const element = document.getElementById(button);
                    if (element) {
                        element.style.position = 'absolute'; // Remove from layout
                        element.style.visibility = 'hidden'; // Make invisible
                    }
                });
                localStorage.setItem('buttonsExpanded', 'false');
            };
        
            const showButtons = () => {
                buttons.forEach(button => {
                    const element = document.getElementById(button);
                    if (element) {
                        element.style.position = 'static'; // Return to normal flow
                        element.style.visibility = 'visible'; // Show the button
                        element.style.marginBottom = '10px'; // Add bottom margin
                        element.style.margineft = '5px'; // Add left margin
                        if (window.innerWidth < 700) {
                            element.style.display = 'block'; // Display as block
                        } else {
                            element.style.display = ''; // Reset display
                            element.style.margin = ''; // Reset margin
                        }
                    }
                });
                localStorage.setItem('buttonsExpanded', 'true');
            };
        
            const checkWidth = () => {
                if (window.innerWidth < 700) {
                    hideButtons();
                } else {
                    showButtons();
                }
            };
        
            // Initially, hide or show buttons based on the width and localStorage state
            if (localStorage.getItem('buttonsExpanded') === 'true') {
                showButtons();
            } else {
                hideButtons();
            }
        
            // Add event listener for window resize
            window.addEventListener('resize', checkWidth);
        
            // Click event on the drop-down menu
            dropMenu.addEventListener('click', () => {
                buttons.forEach(button => {
                    const element = document.getElementById(button);
                    if (element) {
                        if (element.style.visibility === 'hidden') {
                            element.style.position = 'static'; // Return to normal flow
                            element.style.visibility = 'visible'; // Show the button
                            element.style.marginBottom = '10px'; // Add bottom margin
                            if (window.innerWidth < 700) {
                                element.style.display = 'block'; // Display as block                                
                            }
                            localStorage.setItem('buttonsExpanded', 'true');
                        } else {
                            element.style.position = 'absolute'; // Remove from layout
                            element.style.visibility = 'hidden'; // Hide the button
                            localStorage.setItem('buttonsExpanded', 'false');
                        }
                    }
                });
            });
        });

        // clear #about and #research links if in the homepage
        if (window.location.href === 'https://openjournal.eu.org/') {
            document.getElementById('about-button').style.display = 'none';
            document.getElementById('research-button').style.display = 'none';
            document.getElementById('hearts-button').style.display = 'none';
            document.getElementById('comments-button').style.display = 'none';
        }
    </script>
    <button id="current-time"></button>
    <button id="about-button">About</button>
    <script>
        // Create an OpenJournal about page
        const aboutPage = document.createElement('div');
        aboutPage.style.display = 'none';
        aboutPage.style.position = 'fixed';
        aboutPage.style.top = '0';
        aboutPage.style.left = '0';
        aboutPage.style.width = '100%';
        aboutPage.style.height = '100%';
        aboutPage.style.backgroundColor = '#fce5b1';
        aboutPage.style.zIndex = '9999';
        aboutPage.style.overflow = 'auto';
        aboutPage.style.padding = '20px';
        aboutPage.style.boxSizing = 'border-box';
        document.body.appendChild(aboutPage);

        // Add a close button to the about page
        const closeAboutButton = document.createElement('button');
        closeAboutButton.innerHTML = 'Close';
        closeAboutButton.style.position = 'fixed';
        closeAboutButton.style.top = '10px';
        closeAboutButton.style.left = '30px';
        closeAboutButton.addEventListener('click', () => {
            aboutPage.style.display = 'none';
            document.body.style.overflow = ''; // Re-enable main page scroll
            history.back(); // Go back in history when closing the about page
        });
        aboutPage.appendChild(closeAboutButton);
    
        const openAboutButton = document.getElementById('about-button');
        openAboutButton.addEventListener('click', () => {
            aboutPage.style.display = 'block';
            document.body.style.overflow = 'hidden'; // Disable main page scroll
            aboutPage.innerHTML = ''; // Clear existing content to avoid duplication
    
            // Push a new state to the history stack
            history.pushState({ page: 'about' }, 'About', '#about');
    
            // Add content to the about page
            aboutPage.innerHTML = `
                <div style="margin-top: 20px;">
                    <center><img src="icon.png" alt="Icon" width="100" height="100"></center>
                    <center><h1>OpenJournal</h1></center>
                </div>
                <div style="margin-top: 40px;">
                    <center><h2>Our Mission</h2></center>
                    <p>OpenJournal is dedicated to promoting an open internet and open knowledge. We believe that information should be freely accessible to everyone, and we strive to provide a platform where users can stay informed about the latest advancements in technology, science, and research.</p>
                    <p>Our mission is to create a community where knowledge is shared openly and freely, fostering innovation and collaboration across various fields.</p>
                    
                    <center><h2>Open Knowledge</h2></center>
                    <p>OpenJournal is committed to the principles of open knowledge, which include:</p>
                    <ul>
                        <li><strong>Open Access:</strong> Providing free access to information and research papers.</li>
                        <li><strong>Open Source:</strong> Supporting open-source software and tools for collaboration.</li>
                        <li><strong>Open Data:</strong> Encouraging the sharing of data for transparency and reproducibility.</li>
                        <li><strong>Open Science:</strong> Promoting open science practices for the advancement of research.</li>
                    </ul>
    
                    <center><h2>Open Internet</h2></center>
                    <p>OpenJournal advocates for an open internet that is free from censorship and restrictions. We believe in the power of the internet to connect people, share ideas, and foster creativity.</p>
                    <p>By promoting an open internet, we aim to create a space where users can freely express themselves, access information, and engage in meaningful discussions.</p>
                    <center><h2>Guide on how to use OpenJournal</h2></center>
                    <p>Welcome to OpenJournal! Here’s a quick guide to help you navigate and make the most of our website:</p>
                    <ul>
                        <li><strong>Homepage:</strong> The home page displays the latest headlines from Hacker News API. Click on any headline to read the full story. Each article shows points, source, and publication time.</li>
                        <li><strong>Article Information:</strong> Each news article displays points (community score), source website, number of comments, publication date and time, and a like button for saving favorites.</li>
                        <li><strong>Comments Functionality:</strong> Click on the "X comments" button below any article to view hierarchical discussions. Comments are displayed with proper threading and indentation, just like Hacker News.</li>
                        <li><strong>Search Feature:</strong> Use the search bar to find specific stories or topics. Search results show the same information as homepage articles including points and comment counts.</li>
                        <li><strong>Navigation Menu (Top Left Dot):</strong> Access additional pages: About, Blogs, Research, Hearts, Comments overview, and Meet.</li>
                        <li><strong>Time & Weather:</strong> View current time in the header. Click on it to see weather information for your set location.</li>
                        <li><strong>Settings Menu (Top Right):</strong> Access Theme, Categories, News Entries count, Location settings, Show Numbers, and Endless Scroll options.</li>
                        <li><strong>Categories Filter:</strong> Filter headlines by specific topics: Ecology, Economy, History, Mathematics, Philosophy, Physics, Programming, Psychology, Science, Society, Technology, and Videos.</li>
                        <li><strong>News Entries:</strong> Control how many articles display (8, 16, 32, 64, 128, 192, 256). This setting also affects Research and Comments page entries.</li>
                        <li><strong>Location Settings:</strong> Set your city to get localized time and weather information.</li>
                        <li><strong>Show Numbers:</strong> Toggle article numbering on/off for easier reference.</li>
                        <li><strong>Endless Scroll:</strong> Enable infinite scrolling for continuous browsing without pagination.</li>
                        <li><strong>Blogs Page:</strong> Browse a curated collection of independent blogs and personal websites updated regularly.</li>
                        <li><strong>Research Page:</strong> Search academic papers on arXiv. Like and save papers for future reference. Papers show abstracts, authors, and direct PDF links.</li>
                        <li><strong>Hearts Page:</strong> Your personal collection of liked stories, comments, and research papers. Access your saved content anytime.</li>
                        <li><strong>Comments Overview:</strong> Browse all recent story discussions in a grid layout. Each story shows points, comment count, and allows you to load/view comments directly.</li>
                        <li><strong>Meet Page:</strong> Connect with other users through the Meet.hn platform for real-time discussions and local meetups.</li>
                        <li><strong>Article Cards:</strong> Individual articles are displayed in card format with clean borders and spacing for better readability.</li>
                        <li><strong>Responsive Design:</strong> The site adapts to different screen sizes and devices for optimal viewing experience.</li>
                    </ul>
                    <p>We hope you enjoy using OpenJournal and find it to be a valuable resource for staying informed and connected. If you have any questions or feedback, feel free to reach out to us.</p>
                </div>
                <div style="margin-bottom: 80px;"></div>
            `;
            aboutPage.appendChild(closeAboutButton);
        });
    
        // Handle the popstate event to manage back/forward navigation
        window.addEventListener('popstate', (event) => {
            if (event.state && event.state.page === 'about') {
                aboutPage.style.display = 'block';
                document.body.style.overflow = 'hidden'; // Disable main page scroll
            } else {
                aboutPage.style.display = 'none';
                document.body.style.overflow = ''; // Re-enable main page scroll
            }
        });
    
        // Use forward history state to show the About section
        if (history.state && history.state.page === 'about') {
            aboutPage.style.display = 'block';
            document.body.style.overflow = 'hidden'; // Disable main page scroll
        }
    </script>
    <button onclick="window.location.href='https://blogroll.org'" id="blogs-button">Blogs</button>
    <button id="research-button">Research</button>
    <script>
        // Create a page called Research where the person can search for papers on arXiv
        const researchPage = document.createElement('div');
        researchPage.style.display = 'none';
        researchPage.style.position = 'fixed';
        researchPage.style.top = '0';
        researchPage.style.left = '0';
        researchPage.style.width = '100%';
        researchPage.style.height = '100%';
        researchPage.style.backgroundColor = '#fce5b1';
        researchPage.style.zIndex = '9999';
        researchPage.style.overflow = 'auto';
        researchPage.style.padding = '20px';
        researchPage.style.boxSizing = 'border-box';
        document.body.appendChild(researchPage);
    
        // Add a close button to the research page
        const closeResearchButton = document.createElement('button');
        closeResearchButton.innerHTML = 'Close';
        closeResearchButton.style.position = 'fixed';
        closeResearchButton.style.top = '10px';
        closeResearchButton.style.left = '30px';
        closeResearchButton.addEventListener('click', () => {
            // Re-enable main website scroll bar
            document.body.style.overflow = '';
            researchPage.style.display = 'none';
            history.back(); // Go back in history when closing the research page
        });
        researchPage.appendChild(closeResearchButton);
    
        const openResearchButton = document.getElementById('research-button');
    
        openResearchButton.addEventListener('click', () => {
            // Disable main website scroll bar
            document.body.style.overflow = 'hidden';
            
            researchPage.style.display = 'block';
            researchPage.innerHTML = ''; // Clear existing content to avoid duplication
            researchPage.appendChild(closeResearchButton);
    
            // Push a new state to the history stack
            history.pushState({ page: 'research' }, 'Research', '#research');
    
            // Create a form to search for papers on arXiv
            const form = document.createElement('form');
            form.innerHTML = `
                <div style="margin-top: 20px;">
                    <center><img src="icon.png" alt="Icon" width="100" height="100"></center>
                    <center><h1>OpenJournal Research</h1></center>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <input type="text" id="searchInput" placeholder="Research Papers (English Only)" style="margin-right: 1px; width: 250px;">
                    <button type="submit">Search</button>
                </div>
                <div id="searchResults" style="margin-top: 20px;"></div>
            `;
            researchPage.appendChild(form);
    
            // Add event listener to the form to search for papers on arXiv
            form.addEventListener('submit', async event => {
                event.preventDefault();
                const query = document.querySelector('#searchInput').value;
                const results = await searchArxiv(query);
                const searchResults = document.querySelector('#searchResults');
                searchResults.innerHTML = ''; // Clear existing content to avoid duplication
                results.forEach((result, index) => {
                    const paperId = btoa(result.title); // Use base64 encoding of the title as a unique identifier
                    const div = document.createElement('div');
                    div.style.background = 'var(--bg-card)';
                    div.style.border = '1px solid var(--border-color)';
                    div.style.borderRadius = 'var(--border-radius)';
                    div.style.padding = 'var(--spacing-md)';
                    div.style.marginBottom = 'var(--spacing-md)';
                    div.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';
                    div.innerHTML = `
                        <h2>${result.title}</h2>
                        <p><strong>Authors:</strong> ${result.authors.join(', ')}</p>
                        <p>${result.summary}</p>
                        <p><a href="${result.pdf}" target="_blank" rel="noopener" class="pdf-link">PDF</a></p>
                        <p><strong>Date:</strong> ${result.date}</p>
                        <button id="like-button-${paperId}" class="like-button" data-paper-id="${paperId}" data-title="${result.title}" data-authors="${result.authors.join(', ')}" data-summary="${result.summary}" data-pdf="${result.pdf}" data-date="${result.date}" data-liked="false">&#x2661;</button>
                        <span class="like-count" id="like-count-${paperId}">0</span>
                    `;
                    searchResults.appendChild(div);
    
                    // Add event listener to like button
                    const likeButton = div.querySelector('.like-button');
                    likeButton.addEventListener('click', () => {
                        const paperId = likeButton.dataset.paperId;
                        const title = likeButton.dataset.title;
                        const authors = likeButton.dataset.authors;
                        const summary = likeButton.dataset.summary;
                        const pdf = likeButton.dataset.pdf;
                        const date = likeButton.dataset.date;
                        const liked = likeButton.dataset.liked === 'true';
                        const likeCount = document.getElementById(`like-count-${paperId}`);
                        likeButton.dataset.liked = !liked;
                        likeButton.innerHTML = liked ? '&#x2661;' : '&#x2665;';
                        likeCount.textContent = liked ? 0 : 1;
    
                        // Save liked status to localStorage
                        const likedResearchPapers = JSON.parse(localStorage.getItem('likedResearchPapers')) || {};
                        if (!liked) {
                            likedResearchPapers[paperId] = { title, authors, summary, pdf, date };
                        } else {
                            delete likedResearchPapers[paperId];
                        }
                        localStorage.setItem('likedResearchPapers', JSON.stringify(likedResearchPapers));
                    });
    
                    // Load liked status from localStorage
                    const likedResearchPapers = JSON.parse(localStorage.getItem('likedResearchPapers')) || {};
                    if (likedResearchPapers[paperId]) {
                        likeButton.dataset.liked = 'true';
                        likeButton.innerHTML = '&#x2665;';
                        const likeCount = document.getElementById(`like-count-${paperId}`);
                        likeCount.textContent = 1;
                    }
                });
            });
        });
    
        async function searchArxiv(query) {
            const newsEntries = document.querySelector('#news-entries').value;
            const response = await fetch(`https://export.arxiv.org/api/query?search_query=${query}&start=0&max_results=${newsEntries}`);
            const text = await response.text();
            const parser = new DOMParser();
            const xml = parser.parseFromString(text, 'text/xml');
            const entries = xml.querySelectorAll('entry');
            const results = [];
            entries.forEach(entry => {
                const title = entry.querySelector('title').textContent;
                const authors = Array.from(entry.querySelectorAll('author')).map(author => author.querySelector('name').textContent);
                const summary = entry.querySelector('summary').textContent;
                const pdfLink = entry.querySelector('link[type="application/pdf"]');
                // Normalize PDF URL for mobile (avoid http cleartext) and add fallback
                let pdf = '';
                if (pdfLink) {
                    pdf = pdfLink.getAttribute('href') || '';
                }
                if (pdf.startsWith('http://')) {
                    pdf = pdf.replace('http://', 'https://');
                }
                if (!pdf) {
                    const idTag = entry.querySelector('id');
                    if (idTag) {
                        const rawId = idTag.textContent.trim().split('/abs/').pop();
                        if (rawId) {
                            pdf = `https://arxiv.org/pdf/${rawId}.pdf`;
                        }
                    }
                }
                // Some older entries might still miss scheme – enforce https if looks like arxiv id
                if (pdf && pdf.startsWith('//')) {
                    pdf = 'https:' + pdf;
                }
                const date = new Date(entry.querySelector('published').textContent).toLocaleString('en-UK', { day: '2-digit', month: '2-digit', year: 'numeric', hour: 'numeric', minute: 'numeric', hour12: false }).replace(',', '');
                results.push({ title, authors, summary, pdf, date });
            });
            return results;
        }
    
        // Handle the popstate event to manage back/forward navigation
        window.addEventListener('popstate', (event) => {
            if (event.state && event.state.page === 'research') {
                // Disable main website scroll bar
                document.body.style.overflow = 'hidden';
                researchPage.style.display = 'block';
            } else {
                // Re-enable main website scroll bar
                document.body.style.overflow = '';
                researchPage.style.display = 'none';
            }
        });
    
        // Use forward history state to show the Research section
        if (history.state && history.state.page === 'research') {
            researchPage.style.display = 'block';
        }
    </script>
    <button id="hearts-button">My Hearts</button>
    <script>
        // Create a page called Hearts where the person sees the liked stories, comments, and research papers
        const likedStoriesPage = document.createElement('div');
        likedStoriesPage.style.display = 'none';
        likedStoriesPage.style.position = 'fixed';
        likedStoriesPage.style.top = '0';
        likedStoriesPage.style.left = '0';
        likedStoriesPage.style.width = '100%';
        likedStoriesPage.style.height = '100%';
        likedStoriesPage.style.backgroundColor = '#fce5b1';
        likedStoriesPage.style.zIndex = '9999';
        likedStoriesPage.style.overflow = 'auto';
        likedStoriesPage.style.padding = '20px';
        likedStoriesPage.style.boxSizing = 'border-box';
        document.body.appendChild(likedStoriesPage);
    
        // Add an option to remove all entries from the liked stories, comments, and research papers page
        const clearButton = document.createElement('button');
        clearButton.innerHTML = 'Clear All';
        clearButton.style.position = 'fixed';
        clearButton.style.top = '10px';
        clearButton.style.right = '30px';
        clearButton.addEventListener('click', () => {
            localStorage.removeItem('likedStories');
            localStorage.removeItem('likedComments');
            localStorage.removeItem('likedResearchPapers');
            likedStoriesPage.innerHTML = '';
            // Refresh to the main page
            location.reload();
        });
        likedStoriesPage.appendChild(clearButton);
    
        const closeButton = document.createElement('button');
        closeButton.innerHTML = 'Close';
        closeButton.style.position = 'fixed';
        closeButton.style.top = '10px';
        closeButton.style.left = '30px';
        closeButton.addEventListener('click', () => {
            likedStoriesPage.style.display = 'none';
            document.body.style.overflow = ''; // Re-enable main page scroll
            history.back(); // Go back in history when closing the page
        });
        likedStoriesPage.appendChild(closeButton);
    
        const openButton = document.getElementById('hearts-button');
        openButton.addEventListener('click', () => {
            likedStoriesPage.style.display = 'block';
            document.body.style.overflow = 'hidden'; // Disable main page scroll
            likedStoriesPage.innerHTML = ''; // Clear existing content to avoid duplication
            likedStoriesPage.appendChild(clearButton);
            likedStoriesPage.appendChild(closeButton);
    
            // Push a new state to the history stack
            history.pushState({ page: 'my-hearts' }, 'My Hearts', '#my-hearts');
    
            // Get all liked items to determine which sections to show
            const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
            const likedComments = JSON.parse(localStorage.getItem('likedComments')) || {};
            const likedResearchPapers = JSON.parse(localStorage.getItem('likedResearchPapers')) || {};
            
            // Only create sections if there are items to display
            const storiesSection = document.createElement('div');
            const commentsSection = document.createElement('div');
            const researchSection = document.createElement('div');
            
            const hasLikedStories = Object.keys(likedStories).some(id => likedStories[id]);
            const hasLikedComments = Object.keys(likedComments).some(id => likedComments[id]);
            const hasLikedResearch = Object.keys(likedResearchPapers).length > 0;
            
            if (hasLikedStories) {
                storiesSection.innerHTML = '<h2>Liked Stories</h2>';
                likedStoriesPage.appendChild(storiesSection);
            }
            
            if (hasLikedComments) {
                commentsSection.innerHTML = '<h2>Liked Comments</h2>';
                likedStoriesPage.appendChild(commentsSection);
            }
            
            if (hasLikedResearch) {
                researchSection.innerHTML = '<h2>Liked Research Papers</h2>';
                likedStoriesPage.appendChild(researchSection);
            }
    
            // Add a DOM element to the page to update the liked stories
            if (hasLikedStories) {
                Object.keys(likedStories).forEach(storyId => {
                    if (likedStories[storyId]) {
                    fetch(`https://hacker-news.firebaseio.com/v0/item/${storyId}.json`)
                        .then(response => response.json())
                        .then(data => {
                            const { title = 'No Title', url: source = 'Unknown Source', time, score = 0, descendants = 0 } = data;
                            const date = new Date(time * 1000).toLocaleString('en-US', { day: '2-digit', month: '2-digit', year: 'numeric', hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: false });
                            const hostname = new URL(source).hostname;
                            const storyElement = document.createElement('div');
                            storyElement.className = 'hearts-story-element';
                            storyElement.style.background = 'var(--bg-card)';
                            storyElement.style.border = '1px solid var(--border-color)';
                            storyElement.style.borderRadius = 'var(--border-radius)';
                            storyElement.style.padding = 'var(--spacing-md)';
                            storyElement.style.marginBottom = 'var(--spacing-md)';
                            storyElement.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';
                            storyElement.innerHTML = `
                                <h4><a href="${source}" style="user-select: none;">${title}</a></h4>
                                <p style="color: black;">Source: ${hostname}</p>
                                <p style="color: black;">${score} points</p>
                                <p><button class="comments-button" data-story-id="${storyId}">${descendants} comments</button></p>
                                <p style="color: black;">${date}</p>
                                <button onclick="removeLikedStory('${storyId}')">Remove</button>
                            `;
                            storiesSection.appendChild(storyElement);
                            
                            // Add event listener for comments button
                            const commentsButton = storyElement.querySelector('.comments-button');
                            if (commentsButton) {
                                commentsButton.addEventListener('click', () => {
                                    const storyId = commentsButton.dataset.storyId;
                                    openCommentsPage(storyId, title);
                                });
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching story details:', error);
                        });
                    }
                });
            }
    
            // Add a DOM element to the page to update the liked comments
            if (hasLikedComments) {
                Object.keys(likedComments).forEach(commentId => {
                    if (likedComments[commentId]) {
                    fetch(`https://hacker-news.firebaseio.com/v0/item/${commentId}.json`)
                        .then(response => response.json())
                        .then(data => {
                            const { text = 'No Text', time, parent } = data;
                            const date = new Date(time * 1000).toLocaleString('en-US', { day: '2-digit', month: '2-digit', year: 'numeric', hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: false });
    
                            // Fetch the story details
                            fetch(`https://hacker-news.firebaseio.com/v0/item/${parent}.json`)
                                .then(response => response.json())
                                .then(storyData => {
                                    const storyUrl = storyData.url || '#';
                                    const commentElement = document.createElement('div');
                                    commentElement.className = 'hearts-comment-element';
                                    commentElement.style.background = 'var(--bg-card)';
                                    commentElement.style.border = '1px solid var(--border-color)';
                                    commentElement.style.borderRadius = 'var(--border-radius)';
                                    commentElement.style.padding = 'var(--spacing-md)';
                                    commentElement.style.marginBottom = 'var(--spacing-md)';
                                    commentElement.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';
                                    commentElement.innerHTML = `
                                        <p style="color: black;">${text}</p>
                                        <p style="color: black;">Source: <a href="${storyUrl}" target="_blank">${storyUrl.length > 30 ? storyUrl.substring(0, 30) + '...' : storyUrl}</a></p>
                                        <p style="color: black;">By: ${data.by} on ${date.replace(',', '')}</p>
                                        <button onclick="removeLikedComment('${commentId}')">Remove</button>
                                    `;
                                    commentsSection.appendChild(commentElement);
                                })
                                .catch(error => {
                                    console.error('Error fetching story details:', error);
                                });
                        })
                        .catch(error => {
                            console.error('Error fetching comment details:', error);
                        });
                    }
                });
            }
    
            // Add a DOM element to the page to update the liked research papers
            if (hasLikedResearch) {
                Object.keys(likedResearchPapers).forEach(paperId => {
                    if (likedResearchPapers[paperId]) {
                    const paper = likedResearchPapers[paperId];
                    const paperElement = document.createElement('div');
                    paperElement.className = 'hearts-paper-element';
                    paperElement.style.background = 'var(--bg-card)';
                    paperElement.style.border = '1px solid var(--border-color)';
                    paperElement.style.borderRadius = 'var(--border-radius)';
                    paperElement.style.padding = 'var(--spacing-md)';
                    paperElement.style.marginBottom = 'var(--spacing-md)';
                    paperElement.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';
                    paperElement.innerHTML = `
                        <h4><a href="${paper.pdf}" style="user-select: none;">${paper.title}</a></h4>
                        <p style="color: black;">Authors: ${paper.authors}</p>
                        <p style="color: black;">${paper.summary}</p>
                        <p><a href="${paper.pdf}" target="_blank">PDF</a></p>
                        <p style="color: black;">Date: ${paper.date}</p>
                        <button onclick="removeLikedResearchPaper('${paperId}')">Remove</button>
                    `;
                    researchSection.appendChild(paperElement);
                    }
                });
            }
        });
    
        // Listen for the popstate event to handle back navigation
        window.addEventListener('popstate', (event) => {
            if (event.state && event.state.page === 'my-hearts') {
                likedStoriesPage.style.display = 'block';
                document.body.style.overflow = 'hidden'; // Disable main page scroll
            } else {
                likedStoriesPage.style.display = 'none';
                document.body.style.overflow = ''; // Re-enable main page scroll
            }
        });
    
        // Function to remove a liked story
        function removeLikedStory(storyId) {
            const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
            delete likedStories[storyId];
            localStorage.setItem('likedStories', JSON.stringify(likedStories));
            
            // Remove the story element from the DOM instead of reloading
            const storyElements = document.querySelectorAll('.hearts-story-element');
            storyElements.forEach(element => {
                const removeButton = element.querySelector('button[onclick*="removeLikedStory"]');
                if (removeButton && removeButton.getAttribute('onclick').includes(storyId)) {
                    element.remove();
                }
            });
        }
    
        // Function to remove a liked comment
        function removeLikedComment(commentId) {
            const likedComments = JSON.parse(localStorage.getItem('likedComments')) || {};
            delete likedComments[commentId];
            localStorage.setItem('likedComments', JSON.stringify(likedComments));
            
            // Remove the comment element from the DOM instead of reloading
            const commentElements = document.querySelectorAll('.hearts-comment-element');
            commentElements.forEach(element => {
                const removeButton = element.querySelector('button[onclick*="removeLikedComment"]');
                if (removeButton && removeButton.getAttribute('onclick').includes(commentId)) {
                    element.remove();
                }
            });
        }
    
        // Function to remove a liked research paper
        function removeLikedResearchPaper(paperId) {
            const likedResearchPapers = JSON.parse(localStorage.getItem('likedResearchPapers')) || {};
            delete likedResearchPapers[paperId];
            localStorage.setItem('likedResearchPapers', JSON.stringify(likedResearchPapers));
            
            // Remove the research paper element from the DOM instead of reloading
            const paperElements = document.querySelectorAll('.hearts-paper-element');
            paperElements.forEach(element => {
                const removeButton = element.querySelector('button[onclick*="removeLikedResearchPaper"]');
                if (removeButton && removeButton.getAttribute('onclick').includes(paperId)) {
                    element.remove();
                }
            });
        }
    
        // Use forward history state to show the Hearts section
        if (history.state && history.state.page === 'my-hearts') {
            likedStoriesPage.style.display = 'block';
            document.body.style.overflow = 'hidden'; // Disable main page scroll
        }
    </script>
        <button id="comments-button">Comments</button>
        <script>
            // Add a comments section to each story
            const commentsSection = document.createElement('div');
            commentsSection.style.display = 'none';
            commentsSection.style.position = 'fixed';
            commentsSection.style.top = '0';
            commentsSection.style.left = '0';
            commentsSection.style.width = '100%';
            commentsSection.style.height = '100%';
            commentsSection.style.backgroundColor = '#fce5b1';
            commentsSection.style.zIndex = '9999';
            commentsSection.style.flexDirection = 'column';
            commentsSection.style.boxSizing = 'border-box';
            document.body.appendChild(commentsSection);
            
            // Create header for comments section
            const commentsHeader = document.createElement('div');
            commentsHeader.style.padding = '20px';
            commentsHeader.style.borderBottom = '1px solid #ccc';
            commentsHeader.style.backgroundColor = '#f9f9f9';
            commentsHeader.style.flexShrink = '0';
            commentsHeader.innerHTML = `
                <h2 style="margin: 0; padding-right: 40px; font-size: 18px; line-height: 1.4;">Comments</h2>
                <button id="close-comments-main" style="position: absolute; top: 15px; right: 15px; font-size: 24px; border: none; background: none; cursor: pointer; padding: 5px;">×</button>
            `;
            commentsSection.appendChild(commentsHeader);

            // Create scrollable container for comments content
            const commentsScrollContainer = document.createElement('div');
            commentsScrollContainer.style.flex = '1';
            commentsScrollContainer.style.overflow = 'auto';
            commentsScrollContainer.style.padding = '20px';
            commentsScrollContainer.style.maxHeight = 'calc(100vh - 100px)';
            commentsScrollContainer.style.wordWrap = 'break-word';
            commentsScrollContainer.style.overflowWrap = 'break-word';
            commentsSection.appendChild(commentsScrollContainer);
            
            const openCommentsButton = document.getElementById('comments-button');
            
            openCommentsButton.addEventListener('click', () => {
                const newsEntriesSelect = document.getElementById('news-entries');
                const numberOfStories = parseInt(newsEntriesSelect.value, 10);
                const showNumbersCheckbox = document.getElementById('show-numbers');
                const showNumbers = showNumbersCheckbox.checked;
        
                // Disable main website scroll bar
                document.body.style.overflow = 'hidden';
                
                commentsSection.style.display = 'flex';
                commentsScrollContainer.innerHTML = ''; // Clear existing content to avoid duplication
                
                // Add close button event listener
                document.getElementById('close-comments-main').addEventListener('click', () => {
                    // Re-enable main website scroll bar
                    document.body.style.overflow = '';
                    commentsSection.style.display = 'none';
                    history.back(); // Navigate back in history
                });
                
                // Push a new state to the history stack
                history.pushState({ commentsOpen: true }, 'Comments', '#comments');
                
                // Fetch top stories from Hacker News
                fetch('https://hacker-news.firebaseio.com/v0/topstories.json')
                    .then(response => response.json())
                    .then(topStories => {
                        // Fetch details for each top story
                        const storyPromises = topStories.slice(0, numberOfStories).map(storyId => 
                            fetch(`https://hacker-news.firebaseio.com/v0/item/${storyId}.json`).then(response => response.json())
                        );
        
                        Promise.all(storyPromises)
                            .then(stories => {
                                stories.sort((a, b) => b.time - a.time); // Sort stories by their time in descending order
                                const newsGrid = document.createElement('div');
                                newsGrid.style.display = 'grid';
                                newsGrid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(300px, 1fr))';
                                newsGrid.style.gap = '20px';
                                newsGrid.style.maxWidth = '1200px';
                                newsGrid.style.margin = '0 auto';
                                commentsScrollContainer.appendChild(newsGrid);
        
                                stories.forEach((story, index) => {
                                    const { title = 'No Title', url: source = 'Unknown Source', time, kids = [] } = story;
                                    const date = new Date(time * 1000).toLocaleString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }).replace(',', '');
                                    const storyElement = document.createElement('div');
                                    storyElement.style.border = '1px solid #ccc';
                                    storyElement.style.padding = '20px';
                                    storyElement.style.backgroundColor = '#f9f9f9';
                                    storyElement.style.borderRadius = '4px';
                                    storyElement.style.wordWrap = 'break-word';
                                    storyElement.style.overflowWrap = 'break-word';
                                    storyElement.style.boxSizing = 'border-box';
                                    const sourceDomain = source !== 'Unknown Source' ? new URL(source).hostname : source;
                                    storyElement.innerHTML = `
                                        ${showNumbers ? `<p>${index + 1}. </p>` : ''}
                                        <h4><a href="${source}" style="user-select: none;">${title}</a></h4>
                                        <p style="color: black;">Source: <a href="${source}" style="color: blue;">${sourceDomain}</a></p>
                                        <p style="color: black;">${story.score || 0} points</p>
                                        <p style="color: black;">${kids.length} comments</p>
                                        <p style="color: black;">${date}</p>
                                        <button class="load-comments-button" data-story-id="${story.id}" style="margin-bottom: 10px;">Load Comments</button>
                                        <div class="comments-container" id="comments-${story.id}" style="display: none; margin-left: 20px; max-height: 400px; overflow-y: auto; word-wrap: break-word; overflow-wrap: break-word; padding: 10px; border: 1px solid #ddd; border-radius: 4px; background-color: #f9f9f9;"></div>
                                    `;
                                    newsGrid.appendChild(storyElement); // Append stories to the news grid
                                });
                            })
                            .catch(error => {
                                console.error('Error fetching story details:', error);
                            });
                    })
                    .catch(error => {
                        console.error('Error fetching top stories:', error);
                    });
            });
        
            document.addEventListener('click', (event) => {
                if (event.target.classList.contains('load-comments-button')) {
                    const storyId = event.target.getAttribute('data-story-id');
                    const commentsContainer = document.getElementById(`comments-${storyId}`);
                    if (commentsContainer.style.display === 'block') {
                        commentsContainer.style.display = 'none';
                        event.target.innerHTML = 'Load Comments';
                        return;
                    }
                    commentsContainer.style.display = 'block';
                    event.target.innerHTML = 'Unload Comments';
                    commentsContainer.innerHTML = '';
        
                    fetch(`https://hacker-news.firebaseio.com/v0/item/${storyId}.json`)
                        .then(response => response.json())
                        .then(story => {
                            const { kids = [] } = story;
                            if (kids.length === 0) {
                                commentsContainer.innerHTML = '<br>No comments available.<br>';
                                return;
                            }
        
                            const commentsPromises = kids.map(commentId => 
                                fetch(`https://hacker-news.firebaseio.com/v0/item/${commentId}.json`).then(response => response.json())
                            );
                            Promise.all(commentsPromises)
                                .then(comments => {
                                    comments.sort((a, b) => (b.score || 0) - (a.score || 0)); // Sort comments by score (relevance)
                                    comments.forEach(comment => {
                                        const commentDate = new Date(comment.time * 1000).toLocaleString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }).replace(',', '');
                                        const commentElement = document.createElement('div');
                                        commentElement.style.backgroundColor = 'lightgrey';
                                        commentElement.style.padding = '10px';
                                        commentElement.style.marginBottom = '10px';
                                        commentElement.style.borderRadius = '4px';
                                        commentElement.style.wordWrap = 'break-word';
                                        commentElement.style.overflowWrap = 'break-word';
                                        commentElement.style.boxSizing = 'border-box';
                                        commentElement.innerHTML = `
                                            <p style="color: black; word-wrap: break-word; overflow-wrap: break-word; margin: 0 0 10px 0;">${comment.text}</p>
                                            <button class="like-comment-button" data-comment-id="${comment.id}" style="margin-top: 10px;">&#x2661;</button>
                                            <span id="like-count-${comment.id}">0</span>
                                            <p style="color: orange; background-color: black;">By: ${comment.by} on ${commentDate}</p>
                                        `;
                                        commentsContainer.appendChild(commentElement);
        
                                        // Add event listener to like button
                                        const likeButton = commentElement.querySelector('.like-comment-button');
                                        likeButton.addEventListener('click', () => {
                                            const commentId = likeButton.dataset.commentId;
                                            const liked = likeButton.dataset.liked === 'true';
                                            const likeCount = document.getElementById(`like-count-${commentId}`);
                                            likeButton.dataset.liked = !liked;
                                            likeButton.innerHTML = liked ? '&#x2661;' : '&#x2665;';
                                            likeCount.textContent = Number(likeCount.textContent) + (liked ? -1 : 1);
        
                                            // Save liked status to localStorage
                                            const likedComments = JSON.parse(localStorage.getItem('likedComments')) || {};
                                            likedComments[commentId] = !liked;
                                            localStorage.setItem('likedComments', JSON.stringify(likedComments));
                                        });
        
                                        // Load liked status from localStorage
                                        const likedComments = JSON.parse(localStorage.getItem('likedComments')) || {};
                                        if (likedComments[comment.id]) {
                                            likeButton.dataset.liked = 'true';
                                            likeButton.innerHTML = '&#x2665;';
                                            document.getElementById(`like-count-${comment.id}`).textContent = '1';
                                        }
                                    });
                                })
                                .catch(error => {
                                    console.error('Error fetching comment details:', error);
                                });
                        })
                        .catch(error => {
                            console.error('Error fetching story details:', error);
                        });
                }
            });
        
            // Listen for the popstate event to handle back navigation
            window.addEventListener('popstate', (event) => {
                if (event.state && event.state.commentsOpen) {
                    // Disable main website scroll bar
                    document.body.style.overflow = 'hidden';
                    commentsSection.style.display = 'block';
                } else {
                    // Re-enable main website scroll bar
                    document.body.style.overflow = '';
                    commentsSection.style.display = 'none';
                }
            });

            // Use forward history state to show the comments section
            if (history.state && history.state.commentsOpen) {
                commentsSection.style.display = 'block';
            }
        </script>
        <button id="meet-button" style="color: black; text-decoration: none;" onclick="window.location.href='https://meet.hn'">Meet</button>
    <div style="margin-top: 20px;"></div>
    <button id="menu-button">Menu</button>
    <div id="menu" style="display: none;">
        <div>
            <label for="categories">Categories:</label>
            <select id="categories">
                <option value="Yes" selected>Yes</option>
                <option value="No">No</option>
            </select>
        </div>
        <div>
            <label for="navigation">Navigation:</label>
            <select id="navigation">
                <option value="Yes" selected>Yes</option>
                <option value="No">No</option>
            </select>
        </div>
        <div>
            <label for="news-entries">News Entries:</label>
            <select id="news-entries">
                <option value="8">8</option>
                <option value="16">16</option>
                <option value="32" selected>32</option>
                <option value="64">64</option>
                <option value="128">128</option>
                <option value="192">192</option>
                <option value="256">256</option>
            </select>
        </div>
        <div>
            <label for="location">Location:</label>
            <select id="location">
                <option value="Amsterdam">Amsterdam</option>
                <option value="Athens">Athens</option>
                <option value="Barcelona">Barcelona</option>
                <option value="Belgrade">Belgrade</option>
                <option value="Berlin">Berlin</option>
                <option value="Bratislava">Bratislava</option>
                <option value="Brussels">Brussels</option>
                <option value="Bucharest">Bucharest</option>
                <option value="Budapest">Budapest</option>
                <option value="Copenhagen">Copenhagen</option>
                <option value="Dublin">Dublin</option>
                <option value="Edinburgh">Edinburgh</option>
                <option value="Florence">Florence</option>
                <option value="Frankfurt">Frankfurt</option>
                <option value="Geneva">Geneva</option>
                <option value="Gothenburg">Gothenburg</option>
                <option value="Hamburg">Hamburg</option>
                <option value="Helsinki">Helsinki</option>
                <option value="Istanbul">Istanbul</option>
                <option value="Krakow">Krakow</option>
                <option value="Kyiv">Kyiv</option>
                <option value="Lisbon" selected>Lisbon</option>
                <option value="London">London</option>
                <option value="Lyon">Lyon</option>
                <option value="Madrid">Madrid</option>
                <option value="Milan">Milan</option>
                <option value="Moscow">Moscow</option>
                <option value="Munich">Munich</option>
                <option value="Naples">Naples</option>
                <option value="Nice">Nice</option>
                <option value="Oslo">Oslo</option>
                <option value="Paris">Paris</option>
                <option value="Porto">Porto</option>
                <option value="Prague">Prague</option>
                <option value="Reykjavik">Reykjavik</option>
                <option value="Rome">Rome</option>
                <option value="Sarajevo">Sarajevo</option>
                <option value="Seville">Seville</option>
                <option value="Sofia">Sofia</option>
                <option value="Stockholm">Stockholm</option>
                <option value="Tallinn">Tallinn</option>
                <option value="Tbilisi">Tbilisi</option>
                <option value="Vienna">Vienna</option>
                <option value="Warsaw">Warsaw</option>
                <option value="Zurich">Zurich</option>
            </select>
        </div>
        <script>
            const menuButton = document.getElementById('menu-button');
            const menu = document.getElementById('menu');
            menuButton.addEventListener('click', () => {
                if (menu.style.display === 'none') {
                    menu.style.display = 'block';
                } else {
                    menu.style.display = 'none';
                }
            });

            // Display current time
            function displayCurrentTime() {
                const currentTime = new Date().toLocaleString('en-UK', {
                    hour12: false,
                    hourCycle: 'h23',
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: 'numeric',
                    minute: 'numeric'
                }).replace(',', '');
                document.getElementById('current-time').textContent = `${currentTime}`;
            }
            setInterval(displayCurrentTime, 60000);

            displayCurrentTime();

            const locationSelect = document.getElementById('location');

            // Check if location value is stored in localStorage
            if (localStorage.getItem('location')) {
                locationSelect.value = localStorage.getItem('location');
            }

            locationSelect.addEventListener('change', () => {
                localStorage.setItem('location', locationSelect.value);
            });

            const currentTimeButton = document.getElementById('current-time');
            let isShowingTime = true;
            currentTimeButton.addEventListener('click', () => {
                if (isShowingTime) {
                    const location = locationSelect.value;
                    // Make a request to the weather API and display the data on the page
                    fetch(
                        `https://api.openweathermap.org/data/2.5/weather?q=${location}&units=metric&appid=c9ebe3994d9874cae6eacb5377837799`
                    )
                        .then((response) => response.json())
                        .then((data) => {
                            const weatherData = `${data.name} | ${data.weather[0].description} | 
                                                ${Math.floor(data.main.temp)}&deg;C`;
                            currentTimeButton.innerHTML = weatherData;
                        })
                        .catch((error) => {
                            console.error('Error fetching weather data:', error);
                        });
                } else {
                    displayCurrentTime();
                }
                isShowingTime = !isShowingTime;
            });
        </script>
        <div>
            <input type="checkbox" id="show-numbers" checked>
            <label for="show-numbers">Show numbers</label>
        </div>
        <!-- Endless scroll checkbox -->
        <div>
            <input type="checkbox" id="endless-scroll">
            <label for="endless-scroll">Endless Scroll</label>
        </div>
    </div>
    <center>
        <div class="icon-container">
            <img src="icon.png" alt="Icon" width="100" height="100">
          </div>
        <h1>
            <a href="index.html">OpenJournal</a>
        </h1>
        <h5>
            Headlines from the Future
        </h5>
        <div>
            <input type="text" id="search-input" placeholder="Search OpenJournal" style="width: 122px;">
            <button id="search-button">Search</button>
        </div>
        <script>
            // Search OpenJournal
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');

            // Allow user to press Enter key to search
            searchInput.addEventListener('keydown', (event) => {
                if (event.key === 'Enter' && searchInput.value.trim() !== '') {
                    searchButton.click();
                }
            });

            // Save search term to localStorage before page is unloaded
            window.addEventListener('beforeunload', () => {
                const searchTerm = searchInput.value;
                if (searchTerm) {
                localStorage.setItem('searchTerm', searchTerm);
                }
            });

            // Load saved search term from localStorage when the page is loaded
            window.addEventListener('DOMContentLoaded', () => {
                const savedSearchTerm = localStorage.getItem('searchTerm');
                if (savedSearchTerm) {
                searchInput.value = savedSearchTerm;
                }
            });

            // Clear search term from localStorage and input when index.html is clicked
            const indexLink = document.querySelector('a[href="index.html"]');
            indexLink.addEventListener('click', clearSearchTerm);

            // Also clear search term when the page is refreshed
            window.addEventListener('load', clearSearchTerm);

            function clearSearchTerm() {
                localStorage.removeItem('searchTerm');
                searchInput.value = '';
            }  

            searchButton.addEventListener('click', () => {
                // Save endless scroll value to localStorage
                localStorage.setItem('endlessScroll', endlessScrollCheckbox.checked);
                
                const searchTerm = searchInput.value;
                const newsEntries = Number(newsEntriesSelect.value);
                if (searchTerm) {
                    // Set search state
                    isSearching = true;
                    isCategoryMode = false;
                    currentSearchTerm = searchTerm;
                    searchCurrentPage = 0;
                    
                    // Perform search logic here
                    fetch(`https://hn.algolia.com/api/v1/search?query=${encodeURIComponent(searchTerm)}&tags=story&hitsPerPage=${newsEntries}&page=${searchCurrentPage}`)
                        .then(response => response.json())
                        .then(data => {
                            // Clear existing stories
                            newsFeed.innerHTML = '';
                            currentIndex = 0;
                            currentStories = [];

                            // Display search results on the page
                            const hits = data.hits.slice(0, newsEntries);
                            let index = 0;
                            function fetchAndDisplayStory() {
                                if (index < hits.length) {
                                    const hit = hits[index];
                                    const storyElement = document.createElement('div');
                                    storyElement.innerHTML = `
                                        <h4>${showNumbersCheckbox.checked ? ++currentIndex + '. ' : ''}<img src="https://www.google.com/s2/favicons?domain=${new URL(hit.url).hostname}" alt="${new URL(hit.url).hostname} favicon">
                                        <a href="${hit.url}" style="user-select: none;">${hit.title}</a></h4>
                                        <p>Source: ${new URL(hit.url).hostname}</p>
                                        <p>${hit.points} points</p>
                                        <p><button class="comments-button" data-story-id="${hit.objectID}">${hit.num_comments || 0} comments</button></p>
                                        <p>${new Date(hit.created_at_i * 1000).toLocaleString('en-GB', { hour12: false, hourCycle: 'h23' })}</p>
                                        <button class="like-button" data-story-id="${hit.objectID}" data-liked="false">&#x2661;</button>
                                        <span class="like-count" id="like-count-${hit.objectID}">0</span>
                                    `;

                                    // Add event listener to like button
                                    const likeButton = storyElement.querySelector('.like-button');
                                    likeButton.addEventListener('click', () => {
                                        const storyId = likeButton.dataset.storyId;
                                        const liked = likeButton.dataset.liked === 'true';
                                        const likeCount = document.getElementById(`like-count-${storyId}`);
                                        likeButton.dataset.liked = !liked;
                                        likeButton.innerHTML = liked ? '&#x2661;' : '&#x2665;';
                                        likeCount.textContent = Number(likeCount.textContent) + (liked ? -1 : 1);

                                        // Save liked status to localStorage
                                        const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                        likedStories[storyId] = !liked;
                                        localStorage.setItem('likedStories', JSON.stringify(likedStories));
                                    });

                                    // Load liked status from localStorage
                                    const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                    if (likedStories[hit.objectID]) {
                                        likeButton.dataset.liked = 'true';
                                        likeButton.innerHTML = '&#x2665;';
                                    }

                                    // Add event listener to comments button
                                    const commentsButton = storyElement.querySelector('.comments-button');
                                    commentsButton.addEventListener('click', () => {
                                        const storyId = commentsButton.dataset.storyId;
                                        openCommentsPage(storyId, hit.title);
                                    });

                                    currentStories.push(storyElement);
                                    newsFeed.appendChild(storyElement);
                                    newsFeed.appendChild(document.createElement('p'));
                                    index++;
                                    fetchAndDisplayStory();
                                }
                            }
                            fetchAndDisplayStory();
                        })
                        .catch(error => {
                            console.error('Error fetching search results:', error);
                        });
                }
            });

            // Function to load more search results
            function loadMoreSearchResults() {
                if (!isSearching || !currentSearchTerm) return;
                
                searchCurrentPage++;
                const newsEntries = 8; // Load fewer articles for endless scroll
                
                fetch(`https://hn.algolia.com/api/v1/search?query=${encodeURIComponent(currentSearchTerm)}&tags=story&hitsPerPage=${newsEntries}&page=${searchCurrentPage}`)
                    .then(response => response.json())
                    .then(data => {
                        // Append new search results
                        const hits = data.hits.slice(0, newsEntries);
                        let index = 0;
                        
                        function fetchAndDisplayStory() {
                            if (index < hits.length) {
                                const hit = hits[index];
                                const storyElement = document.createElement('div');
                                storyElement.innerHTML = `
                                    <h4>${showNumbersCheckbox.checked ? ++currentIndex + '. ' : ''}<img src="https://www.google.com/s2/favicons?domain=${new URL(hit.url).hostname}" alt="${new URL(hit.url).hostname} favicon">
                                    <a href="${hit.url}" style="user-select: none;">${hit.title}</a></h4>
                                    <p>Source: ${new URL(hit.url).hostname}</p>
                                    <p>${hit.points} points</p>
                                    <p><button class="comments-button" data-story-id="${hit.objectID}">${hit.num_comments || 0} comments</button></p>
                                    <p>${new Date(hit.created_at_i * 1000).toLocaleString('en-GB', { hour12: false, hourCycle: 'h23' })}</p>
                                    <button class="like-button" data-story-id="${hit.objectID}" data-liked="false">&#x2661;</button>
                                    <span class="like-count" id="like-count-${hit.objectID}">0</span>
                                `;
                                
                                // Add event listener to like button
                                const likeButton = storyElement.querySelector('.like-button');
                                likeButton.addEventListener('click', () => {
                                    const storyId = likeButton.dataset.storyId;
                                    const liked = likeButton.dataset.liked === 'true';
                                    const likeCount = document.getElementById(`like-count-${storyId}`);
                                    likeButton.dataset.liked = !liked;
                                    likeButton.innerHTML = liked ? '&#x2661;' : '&#x2665;';
                                    likeCount.textContent = Number(likeCount.textContent) + (liked ? -1 : 1);
                                    
                                    // Save liked status to local storage
                                    const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                    likedStories[storyId] = !liked;
                                    localStorage.setItem('likedStories', JSON.stringify(likedStories));
                                });
                                
                                // Update like button based on local storage
                                const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                if (likedStories[hit.objectID]) {
                                    likeButton.dataset.liked = true;
                                    likeButton.innerHTML = '&#x2665;';
                                    const likeCount = document.getElementById(`like-count-${hit.objectID}`);
                                    likeCount.textContent = Number(likeCount.textContent) + 1;
                                }

                                // Add event listener to comments button
                                const commentsButton = storyElement.querySelector('.comments-button');
                                commentsButton.addEventListener('click', () => {
                                    const storyId = commentsButton.dataset.storyId;
                                    openCommentsPage(storyId, hit.title);
                                });
                                
                                currentStories.push(storyElement);
                                newsFeed.appendChild(storyElement);
                                newsFeed.appendChild(document.createElement('p'));
                                index++;
                                fetchAndDisplayStory();
                            }
                        }
                        fetchAndDisplayStory();
                    })
                    .catch(error => {
                        console.error('Error fetching more search results:', error);
                    });
            }

            // Function to load more category results
            function loadMoreCategoryResults() {
                if (!isCategoryMode || !currentCategory) return;
                
                categoryCurrentPage++;
                const newsEntries = 8; // Load fewer articles for endless scroll
                
                fetch(`https://hn.algolia.com/api/v1/search_by_date?query=${currentCategory}&tags=story&hitsPerPage=${newsEntries}&page=${categoryCurrentPage}`)
                    .then(response => response.json())
                    .then(data => {
                        // Append new category results
                        const hits = data.hits.slice(0, newsEntries);
                        hits.forEach((hit, index) => {
                            const storyElement = document.createElement('div');
                            storyElement.innerHTML = `
                                <h4>${showNumbersCheckbox.checked ? ++currentIndex + '. ' : ''}<img src="https://www.google.com/s2/favicons?domain=${new URL(hit.url).hostname}" alt="${new URL(hit.url).hostname} favicon">
                                <a href="${hit.url}" style="user-select: none;">${hit.title}</a></h4>
                                <p>Source: ${new URL(hit.url).hostname}</p>
                                <p>${hit.points} points</p>
                                <p><button class="comments-button" data-story-id="${hit.objectID}">${hit.num_comments || 0} comments</button></p>
                                <p>${new Date(hit.created_at_i * 1000).toLocaleString('en-GB', { hour12: false, hourCycle: 'h23' })}</p>
                                <button class="like-button" data-story-id="${hit.objectID}" data-liked="false">&#x2661;</button>
                                <span class="like-count" id="like-count-${hit.objectID}">0</span>
                            `;
                            
                            // Add event listener to like button
                            const likeButton = storyElement.querySelector('.like-button');
                            likeButton.addEventListener('click', () => {
                                const storyId = likeButton.dataset.storyId;
                                const liked = likeButton.dataset.liked === 'true';
                                const likeCount = document.getElementById(`like-count-${storyId}`);
                                likeButton.dataset.liked = !liked;
                                likeButton.innerHTML = liked ? '&#x2661;' : '&#x2665;';
                                likeCount.textContent = Number(likeCount.textContent) + (liked ? -1 : 1);
                                
                                // Save liked status to local storage
                                const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                likedStories[storyId] = !liked;
                                localStorage.setItem('likedStories', JSON.stringify(likedStories));
                            });
                            
                            // Update like button based on local storage
                            const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                            if (likedStories[hit.objectID]) {
                                likeButton.dataset.liked = true;
                                likeButton.innerHTML = '&#x2665;';
                                const likeCount = document.getElementById(`like-count-${hit.objectID}`);
                                likeCount.textContent = Number(likeCount.textContent) + 1;
                            }

                            // Add event listener to comments button
                            const commentsButton = storyElement.querySelector('.comments-button');
                            commentsButton.addEventListener('click', () => {
                                const storyId = commentsButton.dataset.storyId;
                                openCommentsPage(storyId, hit.title);
                            });
                            
                            currentStories.push(storyElement);
                            newsFeed.appendChild(storyElement);
                            newsFeed.appendChild(document.createElement('p'));
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching more category results:', error);
                    });
            }
        </script>
        <!-- Create a menu of categories for the user to select -->
        <script>
            const categories = ["&#127810;",
                "&#128176;", "&#8987;",
                "&#960;", "&#x1F4AD;", 
                "&#9883;", "&#128187;", "&#129504;",
                "&#128300;", "&#128101;",
                "&#9881;", "&#9658;"];
        
            const categoryMenu = document.createElement('div');
            categoryMenu.style.display = 'flex';
            categoryMenu.style.justifyContent = 'center';
            categoryMenu.style.gap = '4px';
            categoryMenu.style.marginTop = '20px';

            // Responsive design
            categoryMenu.style.padding = '10px';
            categoryMenu.style.boxSizing = 'border-box';

            // Media queries for responsiveness
            const style = document.createElement('style');
            style.innerHTML = `
                @media (max-width: 600px) {
                    .align-left {
                        font-size: 8px;
                        padding: 5px;
                    }
                }
                @media (min-width: 601px) and (max-width: 1024px) {
                    .align-left {
                        font-size: 12px;
                        padding: 8px;
                    }
                }
                @media (min-width: 1025px) and (max-width: 1440px) {
                    .align-left {
                        font-size: 16px;
                        padding: 10px;
                    }
                }
                @media (min-width: 1441px) {
                    .align-left {
                        font-size: 20px;
                        padding: 12px;
                    }
                }
            `;
            document.head.appendChild(style);         
        
            categories.forEach(category => {
                const categoryButton = document.createElement('button');
                categoryButton.innerHTML = category;
                categoryButton.className = 'align-left';
                categoryButton.addEventListener('click', () => {
                    // If the user clicks on a category Ecology
                    if (category === "&#127810;") {
                        // Set category state
                        isCategoryMode = true;
                        isSearching = false;
                        currentCategory = 'Ecology';
                        categoryCurrentPage = 0;
                        
                        fetch(`https://hn.algolia.com/api/v1/search_by_date?query=Ecology&tags=story&hitsPerPage=${Number(newsEntriesSelect.value)}&page=${categoryCurrentPage}`)
                            .then(response => response.json())
                            .then(data => {
                                // Clear the news feed before adding new stories
                                newsFeed.innerHTML = '';

                                // Display a h2 element with the category name
                                const categoryTitle = document.createElement('h2');
                                categoryTitle.textContent = 'Ecology';
                                categoryTitle.style.textAlign = 'center'; // Center the text
                                categoryTitle.style.marginBottom = '40px'; // Add margin to the bottom
                                newsFeed.appendChild(categoryTitle);

                                const newsEntries = Number(newsEntriesSelect.value);
                                const hits = data.hits.slice(0, newsEntries);
                                hits.forEach((hit, index) => {
                                    const storyElement = document.createElement('div');
                                    storyElement.innerHTML = `
                                        <h4>${index + 1}. <img src="https://www.google.com/s2/favicons?domain=${new URL(hit.url).hostname}" alt="${new URL(hit.url).hostname} favicon">
                                        <a href="${hit.url}" style="user-select: none;">${hit.title}</a></h4>
                                        <p>Source: ${new URL(hit.url).hostname}</p>
                                        <p>${hit.points} points</p>
                                        <p><button class="comments-button" data-story-id="${hit.objectID}">${hit.num_comments || 0} comments</button></p>
                                        <p>${new Date(hit.created_at_i * 1000).toLocaleString('en-GB', { hour12: false, hourCycle: 'h23' })}</p>
                                        <button class="like-button" data-story-id="${hit.objectID}" data-liked="false">&#x2661;</button>
                                        <span class="like-count" id="like-count-${hit.objectID}">0</span>
                                    `;

                                    // Add event listener to like button
                                    const likeButton = storyElement.querySelector('.like-button');
                                    likeButton.addEventListener('click', () => {
                                        const storyId = likeButton.dataset.storyId;
                                        const liked = likeButton.dataset.liked === 'true';
                                        const likeCount = document.getElementById(`like-count-${storyId}`);
                                        likeButton.dataset.liked = !liked;
                                        likeButton.innerHTML = liked ? '&#x2661;' : '&#x2665;';
                                        likeCount.textContent = Number(likeCount.textContent) + (liked ? -1 : 1);

                                        // Save liked status to localStorage
                                        const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                        likedStories[storyId] = !liked;
                                        localStorage.setItem('likedStories', JSON.stringify(likedStories));
                                    });

                                    // Load liked status from localStorage
                                    const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                    if (likedStories[hit.objectID]) {
                                        likeButton.dataset.liked = 'true';
                                        likeButton.innerHTML = '&#x2665;';
                                    }

                                    // Add event listener to comments button
                                    const commentsButton = storyElement.querySelector('.comments-button');
                                    commentsButton.addEventListener('click', () => {
                                        const storyId = commentsButton.dataset.storyId;
                                        openCommentsPage(storyId, hit.title);
                                    });

                                    newsFeed.appendChild(storyElement);
                                    newsFeed.appendChild(document.createElement('p')); // Adds spacing
                                });
                            });
                    }

                    // If the user clicks on a category Economy
                    if (category === "&#128176;") {
                        // Set category state
                        isCategoryMode = true;
                        isSearching = false;
                        currentCategory = 'Economy';
                        categoryCurrentPage = 0;
                        
                        fetch(`https://hn.algolia.com/api/v1/search_by_date?query=Economy&tags=story&hitsPerPage=${Number(newsEntriesSelect.value)}&page=${categoryCurrentPage}`)
                            .then(response => response.json())
                            .then(data => {
                                // Clear the news feed before adding new stories
                                newsFeed.innerHTML = '';

                                // Display a h2 element with the category name
                                const categoryTitle = document.createElement('h2');
                                categoryTitle.textContent = 'Economy';
                                categoryTitle.style.textAlign = 'center'; // Center the text
                                categoryTitle.style.marginBottom = '40px'; // Add margin to the bottom
                                newsFeed.appendChild(categoryTitle);

                                const newsEntries = Number(newsEntriesSelect.value);
                                const hits = data.hits.slice(0, newsEntries);
                                hits.forEach((hit, index) => {
                                    const storyElement = document.createElement('div');
                                    storyElement.innerHTML = `
                                        <h4>${index + 1}. <img src="https://www.google.com/s2/favicons?domain=${new URL(hit.url).hostname}" alt="${new URL(hit.url).hostname} favicon">
                                        <a href="${hit.url}" style="user-select: none;">${hit.title}</a></h4>
                                        <p>Source: ${new URL(hit.url).hostname}</p>
                                        <p>${hit.points} points</p>
                                        <p><button class="comments-button" data-story-id="${hit.objectID}">${hit.num_comments || 0} comments</button></p>
                                        <p>${new Date(hit.created_at_i * 1000).toLocaleString('en-GB', { hour12: false, hourCycle: 'h23' })}</p>
                                        <button class="like-button" data-story-id="${hit.objectID}" data-liked="false">&#x2661;</button>
                                        <span class="like-count" id="like-count-${hit.objectID}">0</span>
                                    `;

                                    // Add event listener to like button
                                    const likeButton = storyElement.querySelector('.like-button');
                                    likeButton.addEventListener('click', () => {
                                        const storyId = likeButton.dataset.storyId;
                                        const liked = likeButton.dataset.liked === 'true';
                                        const likeCount = document.getElementById(`like-count-${storyId}`);
                                        likeButton.dataset.liked = !liked;
                                        likeButton.innerHTML = liked ? '&#x2661;' : '&#x2665;';
                                        likeCount.textContent = Number(likeCount.textContent) + (liked ? -1 : 1);

                                        // Save liked status to localStorage
                                        const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                        likedStories[storyId] = !liked;
                                        localStorage.setItem('likedStories', JSON.stringify(likedStories));
                                    });

                                    // Load liked status from localStorage
                                    const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                    if (likedStories[hit.objectID]) {
                                        likeButton.dataset.liked = 'true';
                                        likeButton.innerHTML = '&#x2665;';
                                    }

                                    // Add event listener to comments button
                                    const commentsButton = storyElement.querySelector('.comments-button');
                                    commentsButton.addEventListener('click', () => {
                                        const storyId = commentsButton.dataset.storyId;
                                        openCommentsPage(storyId, hit.title);
                                    });

                                    newsFeed.appendChild(storyElement);
                                    newsFeed.appendChild(document.createElement('p')); // Adds spacing
                                });
                            });
                    }

                    // If the user clicks on a category History
                    if (category === "&#8987;") {
                        // Set category state
                        isCategoryMode = true;
                        isSearching = false;
                        currentCategory = 'History';
                        categoryCurrentPage = 0;
                        
                        fetch(`https://hn.algolia.com/api/v1/search_by_date?query=History&tags=story&hitsPerPage=${Number(newsEntriesSelect.value)}&page=${categoryCurrentPage}`)
                            .then(response => response.json())
                            .then(data => {
                                // Clear the news feed before adding new stories
                                newsFeed.innerHTML = '';

                                // Display a h2 element with the category name
                                const categoryTitle = document.createElement('h2');
                                categoryTitle.textContent = 'History';
                                categoryTitle.style.textAlign = 'center'; // Center the text
                                categoryTitle.style.marginBottom = '40px'; // Add margin to the bottom
                                newsFeed.appendChild(categoryTitle);

                                const newsEntries = Number(newsEntriesSelect.value);
                                const hits = data.hits.slice(0, newsEntries);
                                hits.forEach((hit, index) => {
                                    const storyElement = document.createElement('div');
                                    storyElement.innerHTML = `
                                        <h4>${index + 1}. <img src="https://www.google.com/s2/favicons?domain=${new URL(hit.url).hostname}" alt="${new URL(hit.url).hostname} favicon">
                                        <a href="${hit.url}" style="user-select: none;">${hit.title}</a></h4>
                                        <p>Source: ${new URL(hit.url).hostname}</p>
                                        <p>${hit.points} points</p>
                                        <p><button class="comments-button" data-story-id="${hit.objectID}">${hit.num_comments || 0} comments</button></p>
                                        <p>${new Date(hit.created_at_i * 1000).toLocaleString('en-GB', { hour12: false, hourCycle: 'h23' })}</p>
                                        <button class="like-button" data-story-id="${hit.objectID}" data-liked="false">&#x2661;</button>
                                        <span class="like-count" id="like-count-${hit.objectID}">0</span>
                                    `;

                                    // Add event listener to like button
                                    const likeButton = storyElement.querySelector('.like-button');
                                    likeButton.addEventListener('click', () => {
                                        const storyId = likeButton.dataset.storyId;
                                        const liked = likeButton.dataset.liked === 'true';
                                        const likeCount = document.getElementById(`like-count-${storyId}`);
                                        likeButton.dataset.liked = !liked;
                                        likeButton.innerHTML = liked ? '&#x2661;' : '&#x2665;';
                                        likeCount.textContent = Number(likeCount.textContent) + (liked ? -1 : 1);

                                        // Save liked status to localStorage
                                        const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                        likedStories[storyId] = !liked;
                                        localStorage.setItem('likedStories', JSON.stringify(likedStories));
                                    });

                                    // Load liked status from localStorage
                                    const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                    if (likedStories[hit.objectID]) {
                                        likeButton.dataset.liked = 'true';
                                        likeButton.innerHTML = '&#x2665;';
                                    }

                                    // Add event listener to comments button
                                    const commentsButton = storyElement.querySelector('.comments-button');
                                    commentsButton.addEventListener('click', () => {
                                        const storyId = commentsButton.dataset.storyId;
                                        openCommentsPage(storyId, hit.title);
                                    });

                                    newsFeed.appendChild(storyElement);
                                    newsFeed.appendChild(document.createElement('p')); // Adds spacing
                                });
                            });
                    }

                    // If the user clicks on a category Mathematics
                    if (category === "&#960;") {
                        // Set category state
                        isCategoryMode = true;
                        isSearching = false;
                        currentCategory = 'Math';
                        categoryCurrentPage = 0;
                        
                        fetch(`https://hn.algolia.com/api/v1/search_by_date?query=Math&tags=story&hitsPerPage=${Number(newsEntriesSelect.value)}&page=${categoryCurrentPage}`)
                            .then(response => response.json())
                            .then(data => {
                                // Clear the news feed before adding new stories
                                newsFeed.innerHTML = '';

                                // Display a h2 element with the category name
                                const categoryTitle = document.createElement('h2');
                                categoryTitle.textContent = 'Mathematics';
                                categoryTitle.style.textAlign = 'center'; // Center the text
                                categoryTitle.style.marginBottom = '40px'; // Add margin to the bottom
                                newsFeed.appendChild(categoryTitle);

                                const newsEntries = Number(newsEntriesSelect.value);
                                const hits = data.hits.slice(0, newsEntries);
                                hits.forEach((hit, index) => {
                                    const storyElement = document.createElement('div');
                                    storyElement.innerHTML = `
                                        <h4>${index + 1}. <img src="https://www.google.com/s2/favicons?domain=${new URL(hit.url).hostname}" alt="${new URL(hit.url).hostname} favicon">
                                        <a href="${hit.url}" style="user-select: none;">${hit.title}</a></h4>
                                        <p>Source: ${new URL(hit.url).hostname}</p>
                                        <p>${hit.points} points</p>
                                        <p><button class="comments-button" data-story-id="${hit.objectID}">${hit.num_comments || 0} comments</button></p>
                                        <p>${new Date(hit.created_at_i * 1000).toLocaleString('en-GB', { hour12: false, hourCycle: 'h23' })}</p>
                                        <button class="like-button" data-story-id="${hit.objectID}" data-liked="false">&#x2661;</button>
                                        <span class="like-count" id="like-count-${hit.objectID}">0</span>
                                    `;

                                    // Add event listener to like button
                                    const likeButton = storyElement.querySelector('.like-button');
                                    likeButton.addEventListener('click', () => {
                                        const storyId = likeButton.dataset.storyId;
                                        const liked = likeButton.dataset.liked === 'true';
                                        const likeCount = document.getElementById(`like-count-${storyId}`);
                                        likeButton.dataset.liked = !liked;
                                        likeButton.innerHTML = liked ? '&#x2661;' : '&#x2665;';
                                        likeCount.textContent = Number(likeCount.textContent) + (liked ? -1 : 1);

                                        // Save liked status to localStorage
                                        const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                        likedStories[storyId] = !liked;
                                        localStorage.setItem('likedStories', JSON.stringify(likedStories));
                                    });

                                    // Load liked status from localStorage
                                    const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                    if (likedStories[hit.objectID]) {
                                        likeButton.dataset.liked = 'true';
                                        likeButton.innerHTML = '&#x2665;';
                                    }

                                    // Add event listener to comments button
                                    const commentsButton = storyElement.querySelector('.comments-button');
                                    commentsButton.addEventListener('click', () => {
                                        const storyId = commentsButton.dataset.storyId;
                                        openCommentsPage(storyId, hit.title);
                                    });

                                    newsFeed.appendChild(storyElement);
                                    newsFeed.appendChild(document.createElement('p')); // Adds spacing
                                });
                            });
                    }

                    // If the user clicks on a category Philosophy
                    if (category === "&#x1F4AD;") {
                        // Set category state
                        isCategoryMode = true;
                        isSearching = false;
                        currentCategory = 'Philosophy';
                        categoryCurrentPage = 0;
                        
                        fetch(`https://hn.algolia.com/api/v1/search_by_date?query=Philosophy&tags=story&hitsPerPage=${Number(newsEntriesSelect.value)}&page=${categoryCurrentPage}`)
                            .then(response => response.json())
                            .then(data => {
                                // Clear the news feed before adding new stories
                                newsFeed.innerHTML = '';

                                // Display a h2 element with the category name
                                const categoryTitle = document.createElement('h2');
                                categoryTitle.textContent = 'Philosophy';
                                categoryTitle.style.textAlign = 'center'; // Center the text
                                categoryTitle.style.marginBottom = '40px'; // Add margin to the bottom
                                newsFeed.appendChild(categoryTitle);

                                const newsEntries = Number(newsEntriesSelect.value);
                                const hits = data.hits.slice(0, newsEntries);
                                hits.forEach((hit, index) => {
                                    const storyElement = document.createElement('div');
                                    storyElement.innerHTML = `
                                        <h4>${index + 1}. <img src="https://www.google.com/s2/favicons?domain=${new URL(hit.url).hostname}" alt="${new URL(hit.url).hostname} favicon">
                                        <a href="${hit.url}" style="user-select: none;">${hit.title}</a></h4>
                                        <p>Source: ${new URL(hit.url).hostname}</p>
                                        <p>${hit.points} points</p>
                                        <p><button class="comments-button" data-story-id="${hit.objectID}">${hit.num_comments || 0} comments</button></p>
                                        <p>${new Date(hit.created_at_i * 1000).toLocaleString('en-GB', { hour12: false, hourCycle: 'h23' })}</p>
                                        <button class="like-button" data-story-id="${hit.objectID}" data-liked="false">&#x2661;</button>
                                        <span class="like-count" id="like-count-${hit.objectID}">0</span>
                                    `;

                                    // Add event listener to like button
                                    const likeButton = storyElement.querySelector('.like-button');
                                    likeButton.addEventListener('click', () => {
                                        const storyId = likeButton.dataset.storyId;
                                        const liked = likeButton.dataset.liked === 'true';
                                        const likeCount = document.getElementById(`like-count-${storyId}`);
                                        likeButton.dataset.liked = !liked;
                                        likeButton.innerHTML = liked ? '&#x2661;' : '&#x2665;';
                                        likeCount.textContent = Number(likeCount.textContent) + (liked ? -1 : 1);

                                        // Save liked status to localStorage
                                        const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                        likedStories[storyId] = !liked;
                                        localStorage.setItem('likedStories', JSON.stringify(likedStories));
                                    });

                                    // Load liked status from localStorage
                                    const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                    if (likedStories[hit.objectID]) {
                                        likeButton.dataset.liked = 'true';
                                        likeButton.innerHTML = '&#x2665;';
                                    }

                                    // Add event listener to comments button
                                    const commentsButton = storyElement.querySelector('.comments-button');
                                    commentsButton.addEventListener('click', () => {
                                        const storyId = commentsButton.dataset.storyId;
                                        openCommentsPage(storyId, hit.title);
                                    });

                                    newsFeed.appendChild(storyElement);
                                    newsFeed.appendChild(document.createElement('p')); // Adds spacing
                                });
                            });
                    }

                    // If the user clicks on a category Physics
                    if (category === "&#9883;") {
                        // Set category state
                        isCategoryMode = true;
                        isSearching = false;
                        currentCategory = 'Physics';
                        categoryCurrentPage = 0;
                        
                        fetch(`https://hn.algolia.com/api/v1/search_by_date?query=Physics&tags=story&hitsPerPage=${Number(newsEntriesSelect.value)}&page=${categoryCurrentPage}`)
                            .then(response => response.json())
                            .then(data => {
                                // Clear the news feed before adding new stories
                                newsFeed.innerHTML = '';

                                // Display a h2 element with the category name
                                const categoryTitle = document.createElement('h2');
                                categoryTitle.textContent = 'Physics';
                                categoryTitle.style.textAlign = 'center'; // Center the text
                                categoryTitle.style.marginBottom = '40px'; // Add margin to the bottom
                                newsFeed.appendChild(categoryTitle);

                                const newsEntries = Number(newsEntriesSelect.value);
                                const hits = data.hits.slice(0, newsEntries);
                                hits.forEach((hit, index) => {
                                    const storyElement = document.createElement('div');
                                    storyElement.innerHTML = `
                                        <h4>${index + 1}. <img src="https://www.google.com/s2/favicons?domain=${new URL(hit.url).hostname}" alt="${new URL(hit.url).hostname} favicon">
                                        <a href="${hit.url}" style="user-select: none;">${hit.title}</a></h4>
                                        <p>Source: ${new URL(hit.url).hostname}</p>
                                        <p>${hit.points} points</p>
                                        <p><button class="comments-button" data-story-id="${hit.objectID}">${hit.num_comments || 0} comments</button></p>
                                        <p>${new Date(hit.created_at_i * 1000).toLocaleString('en-GB', { hour12: false, hourCycle: 'h23' })}</p>
                                        <button class="like-button" data-story-id="${hit.objectID}" data-liked="false">&#x2661;</button>
                                        <span class="like-count" id="like-count-${hit.objectID}">0</span>
                                    `;

                                    // Add event listener to like button
                                    const likeButton = storyElement.querySelector('.like-button');
                                    likeButton.addEventListener('click', () => {
                                        const storyId = likeButton.dataset.storyId;
                                        const liked = likeButton.dataset.liked === 'true';
                                        const likeCount = document.getElementById(`like-count-${storyId}`);
                                        likeButton.dataset.liked = !liked;
                                        likeButton.innerHTML = liked ? '&#x2661;' : '&#x2665;';
                                        likeCount.textContent = Number(likeCount.textContent) + (liked ? -1 : 1);

                                        // Save liked status to localStorage
                                        const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                        likedStories[storyId] = !liked;
                                        localStorage.setItem('likedStories', JSON.stringify(likedStories));
                                    });

                                    // Load liked status from localStorage
                                    const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                    if (likedStories[hit.objectID]) {
                                        likeButton.dataset.liked = 'true';
                                        likeButton.innerHTML = '&#x2665;';
                                    }

                                    // Add event listener to comments button
                                    const commentsButton = storyElement.querySelector('.comments-button');
                                    commentsButton.addEventListener('click', () => {
                                        const storyId = commentsButton.dataset.storyId;
                                        openCommentsPage(storyId, hit.title);
                                    });

                                    newsFeed.appendChild(storyElement);
                                    newsFeed.appendChild(document.createElement('p')); // Adds spacing
                                });
                            });
                    }

                    // If the user clicks on a category Code
                    if (category === "&#128187;") {
                        // Set category state
                        isCategoryMode = true;
                        isSearching = false;
                        currentCategory = 'Show HN';
                        categoryCurrentPage = 0;
                        
                        fetch(`https://hn.algolia.com/api/v1/search_by_date?query=Show%20HN&tags=show_hn&hitsPerPage=${Number(newsEntriesSelect.value)}&page=${categoryCurrentPage}`)
                            .then(response => response.json())
                            .then(data => {
                                // Clear the news feed before adding new stories
                                newsFeed.innerHTML = '';

                                // Display a h2 element with the category name
                                const categoryTitle = document.createElement('h2');
                                categoryTitle.textContent = 'Programming';
                                categoryTitle.style.textAlign = 'center'; // Center the text
                                categoryTitle.style.marginBottom = '40px'; // Add margin to the bottom
                                newsFeed.appendChild(categoryTitle);

                                const newsEntries = Number(newsEntriesSelect.value);
                                const hits = data.hits.slice(0, newsEntries);
                                hits.forEach((hit, index) => {
                                    const storyElement = document.createElement('div');
                                    storyElement.innerHTML = `
                                        <h4>${index + 1}. <img src="https://www.google.com/s2/favicons?domain=${new URL(hit.url).hostname}" alt="${new URL(hit.url).hostname} favicon">
                                        <a href="${hit.url}" style="user-select: none;">${hit.title}</a></h4>
                                        <p>Source: ${new URL(hit.url).hostname}</p>
                                        <p>${hit.points} points</p>
                                        <p><button class="comments-button" data-story-id="${hit.objectID}">${hit.num_comments || 0} comments</button></p>
                                        <p>${new Date(hit.created_at_i * 1000).toLocaleString('en-GB', { hour12: false, hourCycle: 'h23' })}</p>
                                        <button class="like-button" data-story-id="${hit.objectID}" data-liked="false">&#x2661;</button>
                                        <span class="like-count" id="like-count-${hit.objectID}">0</span>
                                    `;

                                    // Add event listener to like button
                                    const likeButton = storyElement.querySelector('.like-button');
                                    likeButton.addEventListener('click', () => {
                                        const storyId = likeButton.dataset.storyId;
                                        const liked = likeButton.dataset.liked === 'true';
                                        const likeCount = document.getElementById(`like-count-${storyId}`);
                                        likeButton.dataset.liked = !liked;
                                        likeButton.innerHTML = liked ? '&#x2661;' : '&#x2665;';
                                        likeCount.textContent = Number(likeCount.textContent) + (liked ? -1 : 1);

                                        // Save liked status to localStorage
                                        const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                        likedStories[storyId] = !liked;
                                        localStorage.setItem('likedStories', JSON.stringify(likedStories));
                                    });

                                    // Load liked status from localStorage
                                    const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                    if (likedStories[hit.objectID]) {
                                        likeButton.dataset.liked = 'true';
                                        likeButton.innerHTML = '&#x2665;';
                                    }

                                    // Add event listener to comments button
                                    const commentsButton = storyElement.querySelector('.comments-button');
                                    commentsButton.addEventListener('click', () => {
                                        const storyId = commentsButton.dataset.storyId;
                                        openCommentsPage(storyId, hit.title);
                                    });

                                    newsFeed.appendChild(storyElement);
                                    newsFeed.appendChild(document.createElement('p')); // Adds spacing
                                });
                            });
                    }

                    // If the user clicks on a category Psychology
                    if (category === "&#129504;") {
                        // Set category state
                        isCategoryMode = true;
                        isSearching = false;
                        currentCategory = 'Psychology';
                        categoryCurrentPage = 0;
                        
                        fetch(`https://hn.algolia.com/api/v1/search_by_date?query=Psychology&tags=story&hitsPerPage=${Number(newsEntriesSelect.value)}&page=${categoryCurrentPage}`)
                            .then(response => response.json())
                            .then(data => {
                                // Clear the news feed before adding new stories
                                newsFeed.innerHTML = '';

                                // Display a h2 element with the category name
                                const categoryTitle = document.createElement('h2');
                                categoryTitle.textContent = 'Psychology';
                                categoryTitle.style.textAlign = 'center'; // Center the text
                                categoryTitle.style.marginBottom = '40px'; // Add margin to the bottom
                                newsFeed.appendChild(categoryTitle);

                                const newsEntries = Number(newsEntriesSelect.value);
                                const hits = data.hits.slice(0, newsEntries);
                                hits.forEach((hit, index) => {
                                    const storyElement = document.createElement('div');
                                    storyElement.innerHTML = `
                                        <h4>${index + 1}. <img src="https://www.google.com/s2/favicons?domain=${new URL(hit.url).hostname}" alt="${new URL(hit.url).hostname} favicon">
                                        <a href="${hit.url}" style="user-select: none;">${hit.title}</a></h4>
                                        <p>Source: ${new URL(hit.url).hostname}</p>
                                        <p>${hit.points} points</p>
                                        <p><button class="comments-button" data-story-id="${hit.objectID}">${hit.num_comments || 0} comments</button></p>
                                        <p>${new Date(hit.created_at_i * 1000).toLocaleString('en-GB', { hour12: false, hourCycle: 'h23' })}</p>
                                        <button class="like-button" data-story-id="${hit.objectID}" data-liked="false">&#x2661;</button>
                                        <span class="like-count" id="like-count-${hit.objectID}">0</span>
                                    `;

                                    // Add event listener to like button
                                    const likeButton = storyElement.querySelector('.like-button');
                                    likeButton.addEventListener('click', () => {
                                        const storyId = likeButton.dataset.storyId;
                                        const liked = likeButton.dataset.liked === 'true';
                                        const likeCount = document.getElementById(`like-count-${storyId}`);
                                        likeButton.dataset.liked = !liked;
                                        likeButton.innerHTML = liked ? '&#x2661;' : '&#x2665;';
                                        likeCount.textContent = Number(likeCount.textContent) + (liked ? -1 : 1);

                                        // Save liked status to localStorage
                                        const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                        likedStories[storyId] = !liked;
                                        localStorage.setItem('likedStories', JSON.stringify(likedStories));
                                    });

                                    // Load liked status from localStorage
                                    const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                    if (likedStories[hit.objectID]) {
                                        likeButton.dataset.liked = 'true';
                                        likeButton.innerHTML = '&#x2665;';
                                    }

                                    // Add event listener to comments button
                                    const commentsButton = storyElement.querySelector('.comments-button');
                                    commentsButton.addEventListener('click', () => {
                                        const storyId = commentsButton.dataset.storyId;
                                        openCommentsPage(storyId, hit.title);
                                    });

                                    newsFeed.appendChild(storyElement);
                                    newsFeed.appendChild(document.createElement('p')); // Adds spacing
                                });
                            });
                    }

                    // If the user clicks on a category Science
                    if (category === "&#128300;") {
                        // Set category state
                        isCategoryMode = true;
                        isSearching = false;
                        currentCategory = 'Science';
                        categoryCurrentPage = 0;
                        
                        fetch(`https://hn.algolia.com/api/v1/search_by_date?query=Science&tags=story&hitsPerPage=${Number(newsEntriesSelect.value)}&page=${categoryCurrentPage}`)
                            .then(response => response.json())
                            .then(data => {
                                // Clear the news feed before adding new stories
                                newsFeed.innerHTML = '';

                                // Display a h2 element with the category name
                                const categoryTitle = document.createElement('h2');
                                categoryTitle.textContent = 'Science';
                                categoryTitle.style.textAlign = 'center'; // Center the text
                                categoryTitle.style.marginBottom = '40px'; // Add margin to the bottom
                                newsFeed.appendChild(categoryTitle);

                                const newsEntries = Number(newsEntriesSelect.value);
                                const hits = data.hits.slice(0, newsEntries);
                                hits.forEach((hit, index) => {
                                    const storyElement = document.createElement('div');
                                    storyElement.innerHTML = `
                                        <h4>${index + 1}. <img src="https://www.google.com/s2/favicons?domain=${new URL(hit.url).hostname}" alt="${new URL(hit.url).hostname} favicon">
                                        <a href="${hit.url}" style="user-select: none;">${hit.title}</a></h4>
                                        <p>Source: ${new URL(hit.url).hostname}</p>
                                        <p>${hit.points} points</p>
                                        <p><button class="comments-button" data-story-id="${hit.objectID}">${hit.num_comments || 0} comments</button></p>
                                        <p>${new Date(hit.created_at_i * 1000).toLocaleString('en-GB', { hour12: false, hourCycle: 'h23' })}</p>
                                        <button class="like-button" data-story-id="${hit.objectID}" data-liked="false">&#x2661;</button>
                                        <span class="like-count" id="like-count-${hit.objectID}">0</span>
                                    `;

                                    // Add event listener to like button
                                    const likeButton = storyElement.querySelector('.like-button');
                                    likeButton.addEventListener('click', () => {
                                        const storyId = likeButton.dataset.storyId;
                                        const liked = likeButton.dataset.liked === 'true';
                                        const likeCount = document.getElementById(`like-count-${storyId}`);
                                        likeButton.dataset.liked = !liked;
                                        likeButton.innerHTML = liked ? '&#x2661;' : '&#x2665;';
                                        likeCount.textContent = Number(likeCount.textContent) + (liked ? -1 : 1);

                                        // Save liked status to localStorage
                                        const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                        likedStories[storyId] = !liked;
                                        localStorage.setItem('likedStories', JSON.stringify(likedStories));
                                    });

                                    // Load liked status from localStorage
                                    const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                    if (likedStories[hit.objectID]) {
                                        likeButton.dataset.liked = 'true';
                                        likeButton.innerHTML = '&#x2665;';
                                    }

                                    // Add event listener to comments button
                                    const commentsButton = storyElement.querySelector('.comments-button');
                                    commentsButton.addEventListener('click', () => {
                                        const storyId = commentsButton.dataset.storyId;
                                        openCommentsPage(storyId, hit.title);
                                    });

                                    newsFeed.appendChild(storyElement);
                                    newsFeed.appendChild(document.createElement('p')); // Adds spacing
                                });
                            });
                    }

                    // If the user clicks on a category Society
                    if (category === "&#128101;") {
                        // Set category state
                        isCategoryMode = true;
                        isSearching = false;
                        currentCategory = 'Society';
                        categoryCurrentPage = 0;
                        
                        fetch(`https://hn.algolia.com/api/v1/search_by_date?query=Society&tags=story&hitsPerPage=${Number(newsEntriesSelect.value)}&page=${categoryCurrentPage}`)
                            .then(response => response.json())
                            .then(data => {
                                // Clear the news feed before adding new stories
                                newsFeed.innerHTML = '';

                                // Display a h2 element with the category name
                                const categoryTitle = document.createElement('h2');
                                categoryTitle.textContent = 'Society';
                                categoryTitle.style.textAlign = 'center'; // Center the text
                                categoryTitle.style.marginBottom = '40px'; // Add margin to the bottom
                                newsFeed.appendChild(categoryTitle);

                                const newsEntries = Number(newsEntriesSelect.value);
                                const hits = data.hits.slice(0, newsEntries);
                                hits.forEach((hit, index) => {
                                    const storyElement = document.createElement('div');
                                    storyElement.innerHTML = `
                                        <h4>${index + 1}. <img src="https://www.google.com/s2/favicons?domain=${new URL(hit.url).hostname}" alt="${new URL(hit.url).hostname} favicon">
                                        <a href="${hit.url}" style="user-select: none;">${hit.title}</a></h4>
                                        <p>Source: ${new URL(hit.url).hostname}</p>
                                        <p>${hit.points} points</p>
                                        <p><button class="comments-button" data-story-id="${hit.objectID}">${hit.num_comments || 0} comments</button></p>
                                        <p>${new Date(hit.created_at_i * 1000).toLocaleString('en-GB', { hour12: false, hourCycle: 'h23' })}</p>
                                        <button class="like-button" data-story-id="${hit.objectID}" data-liked="false">&#x2661;</button>
                                        <span class="like-count" id="like-count-${hit.objectID}">0</span>
                                    `;

                                    // Add event listener to like button
                                    const likeButton = storyElement.querySelector('.like-button');
                                    likeButton.addEventListener('click', () => {
                                        const storyId = likeButton.dataset.storyId;
                                        const liked = likeButton.dataset.liked === 'true';
                                        const likeCount = document.getElementById(`like-count-${storyId}`);
                                        likeButton.dataset.liked = !liked;
                                        likeButton.innerHTML = liked ? '&#x2661;' : '&#x2665;';
                                        likeCount.textContent = Number(likeCount.textContent) + (liked ? -1 : 1);

                                        // Save liked status to localStorage
                                        const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                        likedStories[storyId] = !liked;
                                        localStorage.setItem('likedStories', JSON.stringify(likedStories));
                                    });

                                    // Load liked status from localStorage
                                    const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                    if (likedStories[hit.objectID]) {
                                        likeButton.dataset.liked = 'true';
                                        likeButton.innerHTML = '&#x2665;';
                                    }

                                    // Add event listener to comments button
                                    const commentsButton = storyElement.querySelector('.comments-button');
                                    commentsButton.addEventListener('click', () => {
                                        const storyId = commentsButton.dataset.storyId;
                                        openCommentsPage(storyId, hit.title);
                                    });

                                    newsFeed.appendChild(storyElement);
                                    newsFeed.appendChild(document.createElement('p')); // Adds spacing
                                });
                            });
                    }

                    // If the user clicks on a category Technology
                    if (category === "&#9881;") {
                        // Set category state
                        isCategoryMode = true;
                        isSearching = false;
                        currentCategory = 'Technology';
                        categoryCurrentPage = 0;
                        
                        fetch(`https://hn.algolia.com/api/v1/search_by_date?query=Technology&tags=story&hitsPerPage=${Number(newsEntriesSelect.value)}&page=${categoryCurrentPage}`)
                            .then(response => response.json())
                            .then(data => {
                                // Clear the news feed before adding new stories
                                newsFeed.innerHTML = '';

                                // Display a h2 element with the category name
                                const categoryTitle = document.createElement('h2');
                                categoryTitle.textContent = 'Technology';
                                categoryTitle.style.textAlign = 'center'; // Center the text
                                categoryTitle.style.marginBottom = '40px'; // Add margin to the bottom
                                newsFeed.appendChild(categoryTitle);

                                const newsEntries = Number(newsEntriesSelect.value);
                                const hits = data.hits.slice(0, newsEntries);
                                hits.forEach((hit, index) => {
                                    const storyElement = document.createElement('div');
                                    storyElement.innerHTML = `
                                        <h4>${index + 1}. <img src="https://www.google.com/s2/favicons?domain=${new URL(hit.url).hostname}" alt="${new URL(hit.url).hostname} favicon">
                                        <a href="${hit.url}" style="user-select: none;">${hit.title}</a></h4>
                                        <p>Source: ${new URL(hit.url).hostname}</p>
                                        <p>${hit.points} points</p>
                                        <p><button class="comments-button" data-story-id="${hit.objectID}">${hit.num_comments || 0} comments</button></p>
                                        <p>${new Date(hit.created_at_i * 1000).toLocaleString('en-GB', { hour12: false, hourCycle: 'h23' })}</p>
                                        <button class="like-button" data-story-id="${hit.objectID}" data-liked="false">&#x2661;</button>
                                        <span class="like-count" id="like-count-${hit.objectID}">0</span>
                                    `;

                                    // Add event listener to like button
                                    const likeButton = storyElement.querySelector('.like-button');
                                    likeButton.addEventListener('click', () => {
                                        const storyId = likeButton.dataset.storyId;
                                        const liked = likeButton.dataset.liked === 'true';
                                        const likeCount = document.getElementById(`like-count-${storyId}`);
                                        likeButton.dataset.liked = !liked;
                                        likeButton.innerHTML = liked ? '&#x2661;' : '&#x2665;';
                                        likeCount.textContent = Number(likeCount.textContent) + (liked ? -1 : 1);

                                        // Save liked status to localStorage
                                        const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                        likedStories[storyId] = !liked;
                                        localStorage.setItem('likedStories', JSON.stringify(likedStories));
                                    });

                                    // Load liked status from localStorage
                                    const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                    if (likedStories[hit.objectID]) {
                                        likeButton.dataset.liked = 'true';
                                        likeButton.innerHTML = '&#x2665;';
                                    }

                                    // Add event listener to comments button
                                    const commentsButton = storyElement.querySelector('.comments-button');
                                    commentsButton.addEventListener('click', () => {
                                        const storyId = commentsButton.dataset.storyId;
                                        openCommentsPage(storyId, hit.title);
                                    });

                                    newsFeed.appendChild(storyElement);
                                    newsFeed.appendChild(document.createElement('p')); // Adds spacing
                                });
                            });
                    }

                    // If the user clicks on a category Videos
                    if (category === "&#9658;") {
                        // Set category state
                        isCategoryMode = true;
                        isSearching = false;
                        currentCategory = 'youtube';
                        categoryCurrentPage = 0;
                        
                        fetch(`https://hn.algolia.com/api/v1/search_by_date?query=youtube&tags=story&hitsPerPage=${Number(newsEntriesSelect.value)}&page=${categoryCurrentPage}`)
                            .then(response => response.json())
                            .then(data => {
                                // Clear the news feed before adding new stories
                                newsFeed.innerHTML = '';

                                // Display a h2 element with the category name
                                const categoryTitle = document.createElement('h2');
                                categoryTitle.textContent = 'Videos';
                                categoryTitle.style.textAlign = 'center'; // Center the text
                                categoryTitle.style.marginBottom = '40px'; // Add margin to the bottom
                                newsFeed.appendChild(categoryTitle);

                                const newsEntries = Number(newsEntriesSelect.value);
                                const hits = data.hits.slice(0, newsEntries);
                                hits.forEach((hit, index) => {
                                    const storyElement = document.createElement('div');
                                    storyElement.innerHTML = `
                                        <h4>${index + 1}. <img src="https://www.google.com/s2/favicons?domain=${new URL(hit.url).hostname}" alt="${new URL(hit.url).hostname} favicon">
                                        <a href="${hit.url}" style="user-select: none;">${hit.title}</a></h4>
                                        <p>Source: ${new URL(hit.url).hostname}</p>
                                        <p>${hit.points} points</p>
                                        <p><button class="comments-button" data-story-id="${hit.objectID}">${hit.num_comments || 0} comments</button></p>
                                        <p>${new Date(hit.created_at_i * 1000).toLocaleString('en-GB', { hour12: false, hourCycle: 'h23' })}</p>
                                        <button class="like-button" data-story-id="${hit.objectID}" data-liked="false">&#x2661;</button>
                                        <span class="like-count" id="like-count-${hit.objectID}">0</span>
                                    `;

                                    // Add event listener to like button
                                    const likeButton = storyElement.querySelector('.like-button');
                                    likeButton.addEventListener('click', () => {
                                        const storyId = likeButton.dataset.storyId;
                                        const liked = likeButton.dataset.liked === 'true';
                                        const likeCount = document.getElementById(`like-count-${storyId}`);
                                        likeButton.dataset.liked = !liked;
                                        likeButton.innerHTML = liked ? '&#x2661;' : '&#x2665;';
                                        likeCount.textContent = Number(likeCount.textContent) + (liked ? -1 : 1);

                                        // Save liked status to localStorage
                                        const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                        likedStories[storyId] = !liked;
                                        localStorage.setItem('likedStories', JSON.stringify(likedStories));
                                    });

                                    // Load liked status from localStorage
                                    const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                                    if (likedStories[hit.objectID]) {
                                        likeButton.dataset.liked = 'true';
                                        likeButton.innerHTML = '&#x2665;';
                                    }

                                    // Add event listener to comments button
                                    const commentsButton = storyElement.querySelector('.comments-button');
                                    commentsButton.addEventListener('click', () => {
                                        const storyId = commentsButton.dataset.storyId;
                                        openCommentsPage(storyId, hit.title);
                                    });

                                    newsFeed.appendChild(storyElement);
                                    newsFeed.appendChild(document.createElement('p')); // Adds spacing
                                });
                            });
                    }

                    console.log(`Selected category: ${category}`);
                });
                categoryMenu.appendChild(categoryButton);
            });
        
            document.body.appendChild(categoryMenu);
        </script>
    </center>
    <div id="news-feed"></div>
    <!-- Hacker News API -->
    <script>
        const newsEntriesSelect = document.getElementById('news-entries');
        const newsFeed = document.getElementById('news-feed');
        const showNumbersCheckbox = document.getElementById('show-numbers');
        const endlessScrollCheckbox = document.getElementById('endless-scroll');

        let currentStories = [];
        let currentIndex = 0;

        function fetchAndDisplayStories(topStories) {
            topStories.forEach((storyId) => {
            fetch(`https://hacker-news.firebaseio.com/v0/item/${storyId}.json`)
                .then(response => response.json())
                .then(story => {
                    const storyElement = document.createElement('div');
                    storyElement.innerHTML = `
                        <h4>${showNumbersCheckbox.checked ? ++currentIndex + '. ' : ''}<img src="https://www.google.com/s2/favicons?domain=${new URL(story.url).hostname}" alt="${new URL(story.url).hostname} favicon">
                        <a href="${story.url}" style="user-select: none;">${story.title}</a></h4>
                        <p>Source: ${new URL(story.url).hostname}</p>
                        <p>${story.score} points</p>
                        <p><button class="comments-button" data-story-id="${story.id}">${story.descendants || 0} comments</button></p>
                        <p>${new Date(story.time * 1000).toLocaleString('en-GB', { hour12: false, hourCycle: 'h23' })}</p>
                        <button class="like-button" data-story-id="${story.id}" data-liked="false">&#x2661;</button>
                        <span class="like-count" id="like-count-${story.id}">0</span>
                    `;
                currentStories.push(storyElement);
                newsFeed.appendChild(storyElement);
                newsFeed.appendChild(document.createElement('p'));

                // Add event listener to like button
                const likeButton = storyElement.querySelector('.like-button');
                likeButton.addEventListener('click', () => {
                    const storyId = likeButton.dataset.storyId;
                    const liked = likeButton.dataset.liked === 'true';
                    const likeCount = document.getElementById(`like-count-${storyId}`);
                    likeButton.dataset.liked = !liked;
                    likeButton.innerHTML = liked ? '&#x2661;' : '&#x2665;';
                    likeCount.textContent = Number(likeCount.textContent) + (liked ? -1 : 1);

                    // Save liked status to local storage
                    const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                    likedStories[storyId] = !liked;
                    localStorage.setItem('likedStories', JSON.stringify(likedStories));
                });

                // Update like button and like count based on local storage
                const likedStories = JSON.parse(localStorage.getItem('likedStories')) || {};
                if (likedStories[story.id]) {
                    likeButton.dataset.liked = true;
                    likeButton.innerHTML = '&#x2665;';
                    const likeCount = document.getElementById(`like-count-${story.id}`);
                    likeCount.textContent = Number(likeCount.textContent) + 1;
                }

                // Add event listener to comments button
                const commentsButton = storyElement.querySelector('.comments-button');
                commentsButton.addEventListener('click', () => {
                    const storyId = commentsButton.dataset.storyId;
                    openCommentsPage(storyId, story.title);
                });
                });
            });
        }

        // Initialize lastIndex to 0
        let lastIndex = 0;

        // Search pagination variables
        let searchCurrentPage = 0;
        let currentSearchTerm = '';
        let isSearching = false;

        // Category pagination variables
        let categoryCurrentPage = 0;
        let currentCategory = '';
        let isCategoryMode = false;

        function fetchAndDisplayTopStories() {
            fetch('https://hacker-news.firebaseio.com/v0/topstories.json')
            .then(response => response.json())
            .then(data => {
                // Calculate the new last index based on the number of entries to fetch
                const newLastIndex = lastIndex + parseInt(newsEntriesSelect.value);
                // Slice the data from the last index to the new last index
                const topStories = data.slice(lastIndex, newLastIndex);
                // Update lastIndex for the next fetch
                lastIndex = newLastIndex;
                // Fetch and display the stories
                fetchAndDisplayStories(topStories);
            });
        }

        function fetchAndDisplayTopStoriesEndlessScroll() {
            fetch('https://hacker-news.firebaseio.com/v0/topstories.json')
            .then(response => response.json())
            .then(data => {
                // Load only 8 articles for endless scroll
                const endlessScrollBatchSize = 8;
                const newLastIndex = lastIndex + endlessScrollBatchSize;
                // Slice the data from the last index to the new last index
                const topStories = data.slice(lastIndex, newLastIndex);
                // Update lastIndex for the next fetch
                lastIndex = newLastIndex;
                // Fetch and display the stories
                fetchAndDisplayStories(topStories);
            });
        }

        // Check if Show Numbers value is stored in localStorage
        if (localStorage.getItem('showNumbers')) {
            showNumbersCheckbox.checked = localStorage.getItem('showNumbers') === 'true';
        }

        // Check if endless scroll value is stored in localStorage
        if (localStorage.getItem('endlessScroll')) {
            endlessScrollCheckbox.checked = localStorage.getItem('endlessScroll') === 'true';
            
            // Initialize scroll handler if endless scroll is enabled
            if (endlessScrollCheckbox.checked) {
                scrollHandler = () => {
                    if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 15)) { // 5 pixels threshold
                        if (isSearching) {
                            loadMoreSearchResults();
                        } else if (isCategoryMode) {
                            loadMoreCategoryResults();
                        } else {
                            fetchAndDisplayTopStoriesEndlessScroll();
                        }
                    }
                };
                window.addEventListener('scroll', scrollHandler);
            }
        }

        fetchAndDisplayTopStories();

        showNumbersCheckbox.addEventListener('change', () => {
            localStorage.setItem('showNumbers', showNumbersCheckbox.checked);
            location.reload();
        });
        
        newsEntriesSelect.addEventListener('change', () => {
            localStorage.setItem('newsEntries', newsEntriesSelect.value);
            location.reload();
        });

        // Store reference to scroll handler for cleanup
        let scrollHandler = null;

        endlessScrollCheckbox.addEventListener('change', () => {
            localStorage.setItem('endlessScroll', endlessScrollCheckbox.checked);
            
            if (endlessScrollCheckbox.checked) {
                // Create and add scroll event listener
                scrollHandler = () => {
                    if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 15)) { // 5 pixels threshold
                        if (isSearching) {
                            loadMoreSearchResults();
                        } else if (isCategoryMode) {
                            loadMoreCategoryResults();
                        } else {
                            fetchAndDisplayTopStoriesEndlessScroll();
                        }
                    }
                };
                window.addEventListener('scroll', scrollHandler);
            } else {
                // Remove scroll event listener when unchecked
                if (scrollHandler) {
                    window.removeEventListener('scroll', scrollHandler);
                    scrollHandler = null;
                }
            }
        });

        // Load saved news entries value from localStorage when the page is loaded
        window.addEventListener('DOMContentLoaded', () => {
            const savedNewsEntries = localStorage.getItem('newsEntries');
            if (savedNewsEntries) {
                newsEntriesSelect.value = savedNewsEntries;
            }
        });

        // Select the categories element
        const categoriesSelect = document.querySelector('#categories');

        // Select the categoryMenu element
        categoriesSelect.addEventListener('change', () => {
            if (categoriesSelect.value === 'Yes') {
                // If the selected value is 'Yes', enable the categoryMenu
                categoryMenu.style.display = 'flex';
                localStorage.setItem('categoryMenuEnabled', 'true');
            } else if (categoriesSelect.value === 'No') {
                // If the selected value is 'No', disable the categoryMenu
                categoryMenu.style.display = 'none';
                localStorage.setItem('categoryMenuEnabled', 'false');
            }
        });

        // Load saved category menu state from localStorage when the page is loaded
        window.addEventListener('DOMContentLoaded', () => {
            const categoryMenuEnabled = localStorage.getItem('categoryMenuEnabled');
            if (categoryMenuEnabled === 'true') {
                categoriesSelect.value = 'Yes';
                categoryMenu.style.display = 'flex';
            } else if (categoryMenuEnabled === 'false') {
                categoriesSelect.value = 'No';
                categoryMenu.style.display = 'none';
            }
        });

        // Select the navigationSelect element
        const navigationSelect = document.querySelector('#navigation');

        navigationSelect.addEventListener('change', () => {
            if (navigationSelect.value === 'Yes') {
                // If the selected value is 'Yes', enable the navigationMenu
                navigationMenu.style.display = 'flex';
                localStorage.setItem('navigationMenuEnabled', 'true');
            } else if (navigationSelect.value === 'No') {
                // If the selected value is 'No', disable the navigationMenu
                navigationMenu.style.display = 'none';
                localStorage.setItem('navigationMenuEnabled', 'false');
            }
        });

        // Load saved navigation menu state from localStorage when the page is loaded
        window.addEventListener('DOMContentLoaded', () => {
            const navigationMenuEnabled = localStorage.getItem('navigationMenuEnabled');
            if (navigationMenuEnabled === 'true') {
                navigationSelect.value = 'Yes';
                navigationMenu.style.display = 'flex';
            } else if (navigationMenuEnabled === 'false') {
                navigationSelect.value = 'No';
                navigationMenu.style.display = 'none';
            }
        });

        // Check if Endless Scroll value is stored in localStorage
        if (localStorage.getItem('endlessScroll')) {
            endlessScrollCheckbox.checked = localStorage.getItem('endlessScroll') === 'true';
        }
    </script>
    <!-- Create a menu of navigation buttons -->
    <script>
        // cria um menu de navegação com botões de back, foward e reload
        function goBack() {
            window.history.back();
        }

        function goForward() {
            window.history.forward();
        }

        function reloadPage() {
            location.reload();
        }

        const backButton = document.createElement('button');
        backButton.innerHTML = '&#x23EA;';
        backButton.className = 'align-left';
        backButton.addEventListener('click', goBack);
        document.body.appendChild(backButton);

        const forwardButton = document.createElement('button');
        forwardButton.innerHTML = '&#x23E9;';
        forwardButton.className = 'align-left';
        forwardButton.addEventListener('click', goForward);
        document.body.appendChild(forwardButton);

        const reloadButton = document.createElement('button');
        reloadButton.innerHTML = '&#x21BB;';
        reloadButton.className = 'align-center';
        reloadButton.addEventListener('click', reloadPage);
        document.body.appendChild(reloadButton);

        // cria um botão para ir para o topo da página
        const topButton = document.createElement('button');
        topButton.innerHTML = '&#x2191;';
        topButton.className = 'align-center';
        topButton.addEventListener('click', () => {
            window.scrollTo(0, 0);
        });
        document.body.appendChild(topButton);

        // cria um botão para ir para o fim da página
        const bottomButton = document.createElement('button');
        bottomButton.innerHTML = '&#x2193;';
        bottomButton.className = 'align-center';
        bottomButton.addEventListener('click', () => {
            window.scrollTo(0, document.body.scrollHeight);
        });
        document.body.appendChild(bottomButton);

        // Estilo para o menu de navegação
        const navigationMenu = document.createElement('div');
        navigationMenu.style.position = 'fixed';
        navigationMenu.style.bottom = '15px';
        navigationMenu.style.left = '50%';
        navigationMenu.style.transform = 'translateX(-50%)';
        navigationMenu.style.display = 'flex';
        navigationMenu.style.flexDirection = 'row';
        navigationMenu.style.gap = '10px';
        navigationMenu.style.zIndex = '9999';
        navigationMenu.appendChild(backButton);
        navigationMenu.appendChild(forwardButton);
        navigationMenu.appendChild(reloadButton);
        navigationMenu.appendChild(topButton);
        navigationMenu.appendChild(bottomButton);
        document.body.appendChild(navigationMenu);

        // Function to open individual comments page
        function openCommentsPage(storyId, storyTitle) {
            // Create overlay
            const overlay = document.createElement('div');
            overlay.id = 'comments-overlay';
            overlay.style.position = 'fixed';
            overlay.style.top = '0';
            overlay.style.left = '0';
            overlay.style.width = '100%';
            overlay.style.height = '100%';
            overlay.style.backgroundColor = 'white';
            overlay.style.zIndex = '9999';
            overlay.style.display = 'flex';
            overlay.style.flexDirection = 'column';

            // Create header
            const header = document.createElement('div');
            header.style.padding = '20px';
            header.style.borderBottom = '1px solid #ccc';
            header.style.backgroundColor = '#f9f9f9';
            header.style.flexShrink = '0';
            header.innerHTML = `
                <h2 style="margin: 0; padding-right: 40px; font-size: 18px; line-height: 1.4;">${storyTitle}</h2>
                <button id="close-comments" style="position: absolute; top: 15px; right: 15px; font-size: 24px; border: none; background: none; cursor: pointer; padding: 5px;">×</button>
            `;
            overlay.appendChild(header);

            // Create scrollable comments container
            const scrollContainer = document.createElement('div');
            scrollContainer.style.flex = '1';
            scrollContainer.style.overflow = 'auto';
            scrollContainer.style.padding = '20px';
            scrollContainer.style.maxHeight = 'calc(100vh - 100px)';
            scrollContainer.style.wordWrap = 'break-word';
            scrollContainer.style.overflowWrap = 'break-word';
            
            const commentsContainer = document.createElement('div');
            commentsContainer.id = 'comments-container';
            commentsContainer.style.maxWidth = '800px';
            commentsContainer.style.margin = '0 auto';
            commentsContainer.style.wordWrap = 'break-word';
            commentsContainer.style.overflowWrap = 'break-word';
            commentsContainer.style.boxSizing = 'border-box';
            
            scrollContainer.appendChild(commentsContainer);
            overlay.appendChild(scrollContainer);

            // Disable main website scroll bar
            document.body.style.overflow = 'hidden';

            // Add to body
            document.body.appendChild(overlay);

            // Add close functionality
            const closeComments = () => {
                // Re-enable main website scroll bar
                document.body.style.overflow = '';
                // Remove overlay
                if (document.body.contains(overlay)) {
                    document.body.removeChild(overlay);
                }
            };

            document.getElementById('close-comments').addEventListener('click', () => {
                closeComments();
                history.back();
            });

            // Update URL and set up popstate handler
            history.pushState({ commentsOpen: true, storyId: storyId }, '', `#comments-${storyId}`);
            
            // Handle browser back button
            const handlePopState = (event) => {
                if (!event.state || !event.state.commentsOpen) {
                    closeComments();
                    window.removeEventListener('popstate', handlePopState);
                }
            };
            window.addEventListener('popstate', handlePopState);

            // Load comments
            loadCommentsForStory(storyId);
        }

        // Function to load comments for a specific story
        function loadCommentsForStory(storyId) {
            const container = document.getElementById('comments-container');
            container.innerHTML = '<p>Loading comments...</p>';

            fetch(`https://hacker-news.firebaseio.com/v0/item/${storyId}.json`)
                .then(response => response.json())
                .then(story => {
                    if (story.kids && story.kids.length > 0) {
                        container.innerHTML = '';
                        loadCommentsRecursively(story.kids, container, 0);
                    } else {
                        container.innerHTML = '<p>No comments available.</p>';
                    }
                })
                .catch(error => {
                    container.innerHTML = '<p>Error loading comments.</p>';
                });
        }

        // Function to load comments recursively (hierarchical)
        function loadCommentsRecursively(commentIds, container, level) {
            commentIds.forEach(commentId => {
                fetch(`https://hacker-news.firebaseio.com/v0/item/${commentId}.json`)
                    .then(response => response.json())
                    .then(comment => {
                        if (comment && comment.text) {
                            const commentDiv = document.createElement('div');
                            commentDiv.style.marginLeft = `${level * 20}px`;
                            commentDiv.style.marginBottom = '10px';
                            commentDiv.style.padding = '10px';
                            commentDiv.style.border = '1px solid #ccc';
                            commentDiv.style.borderRadius = '3px';
                            commentDiv.style.backgroundColor = level % 2 === 0 ? '#f9f9f9' : '#ffffff';
                            commentDiv.style.wordWrap = 'break-word';
                            commentDiv.style.overflowWrap = 'break-word';
                            commentDiv.style.maxWidth = '100%';
                            commentDiv.style.boxSizing = 'border-box';
                            
                            // Create header
                            const headerDiv = document.createElement('div');
                            headerDiv.style.fontWeight = 'bold';
                            headerDiv.style.marginBottom = '5px';
                            headerDiv.style.fontSize = '14px';
                            headerDiv.style.color = '#333';
                            headerDiv.textContent = `${comment.by} - ${new Date(comment.time * 1000).toLocaleString()}`;
                            
                            // Create content div with proper text wrapping
                            const contentDiv = document.createElement('div');
                            contentDiv.style.fontSize = '14px';
                            contentDiv.style.lineHeight = '1.5';
                            contentDiv.style.color = '#444';
                            contentDiv.style.wordWrap = 'break-word';
                            contentDiv.style.overflowWrap = 'break-word';
                            contentDiv.style.whiteSpace = 'pre-wrap';
                            contentDiv.style.maxWidth = '100%';
                            contentDiv.innerHTML = comment.text;
                            
                            // Fix all links in the content to not overflow
                            const links = contentDiv.querySelectorAll('a');
                            links.forEach(link => {
                                link.style.wordBreak = 'break-all';
                                link.style.color = '#0000ff';
                                link.style.textDecoration = 'underline';
                                link.style.maxWidth = '100%';
                                link.style.display = 'inline-block';
                                link.style.overflowWrap = 'break-word';
                            });
                            
                            // Fix code blocks and pre elements
                            const codeElements = contentDiv.querySelectorAll('code, pre');
                            codeElements.forEach(code => {
                                code.style.whiteSpace = 'pre-wrap';
                                code.style.wordWrap = 'break-word';
                                code.style.overflowWrap = 'break-word';
                                code.style.maxWidth = '100%';
                                code.style.overflow = 'hidden';
                                code.style.fontSize = '13px';
                                code.style.backgroundColor = '#f0f0f0';
                                code.style.padding = '2px 4px';
                                code.style.borderRadius = '2px';
                            });
                            
                            // Fix any other potential overflow elements
                            const allElements = contentDiv.querySelectorAll('*');
                            allElements.forEach(element => {
                                element.style.maxWidth = '100%';
                                element.style.boxSizing = 'border-box';
                            });
                            
                            // Create heart button section
                            const heartDiv = document.createElement('div');
                            heartDiv.style.marginTop = '8px';
                            
                            const heartButton = document.createElement('button');
                            heartButton.className = 'like-comment-button';
                            heartButton.setAttribute('data-comment-id', commentId);
                            heartButton.innerHTML = '&#x2661;';
                            heartButton.style.marginRight = '8px';
                            
                            const heartCount = document.createElement('span');
                            heartCount.id = `like-count-${commentId}`;
                            heartCount.textContent = '0';
                            heartCount.style.fontSize = '14px';
                            heartCount.style.color = '#666';
                            
                            heartDiv.appendChild(heartButton);
                            heartDiv.appendChild(heartCount);
                            
                            // Add event listener to heart button
                            heartButton.addEventListener('click', () => {
                                const liked = heartButton.dataset.liked === 'true';
                                const likeCount = document.getElementById(`like-count-${commentId}`);
                                heartButton.dataset.liked = !liked;
                                heartButton.innerHTML = liked ? '&#x2661;' : '&#x2665;';
                                likeCount.textContent = Number(likeCount.textContent) + (liked ? -1 : 1);

                                // Save liked status to localStorage
                                const likedComments = JSON.parse(localStorage.getItem('likedComments')) || {};
                                likedComments[commentId] = !liked;
                                localStorage.setItem('likedComments', JSON.stringify(likedComments));
                            });

                            // Load liked status from localStorage
                            const likedComments = JSON.parse(localStorage.getItem('likedComments')) || {};
                            if (likedComments[commentId]) {
                                heartButton.dataset.liked = 'true';
                                heartButton.innerHTML = '&#x2665;';
                                heartCount.textContent = '1';
                            }
                            
                            commentDiv.appendChild(headerDiv);
                            commentDiv.appendChild(contentDiv);
                            commentDiv.appendChild(heartDiv);
                            container.appendChild(commentDiv);

                            // Load child comments recursively
                            if (comment.kids && comment.kids.length > 0) {
                                loadCommentsRecursively(comment.kids, container, level + 1);
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Error loading comment:', error);
                    });
            });
        }
    </script>
</body>
<footer>
    <center>
        <h6>
            <p></p>
            <p style="margin-bottom: 80px;">Copyright &copy; 2025 Made with 🤎 by <a href="https://machaddr.com">Andr&eacute Machado</a></p>
            <p></p>
        </h6>
    </center>
</footer>
</html>
